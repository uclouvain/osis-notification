var Wr=Object.defineProperty;var o=(e,t)=>Wr(e,"name",{value:t,configurable:!0});import{k as St,l as G,m as W,n as X,p as je,q as dn,t as we,u as be,f as Xr,v as hn,F as Jr,x as Kr,y as Yr}from"./vue.esm-bundler-f87cfd15.js";function Qr(e,t,n){var i={},a="",c="...",d=10>t?t:10,h=["img","br"],u=[],p=0,f=a,m='([\\w|-]+\\s*(=\\s*"[^"]*")?\\s*)*',y="\\s*\\/?\\s*",v="\\s*\\/\\s*",_=new RegExp("<\\/?\\w+\\s*"+m+v+">"),P=new RegExp("<\\/?\\w+\\s*"+m+y+">"),q=/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)|((mailto:)?[_.\w\-]+@([\w][\w\-]+\.)+[a-zA-Z]{2,3})/g,de=new RegExp("<img\\s*"+m+y+">"),x=new RegExp("\\W+","g"),S=!0,$,L,z,D;function Te(N){var M=de.exec(N),F,j;return M?(F=M.index,j=M[0].length,N.substring(0,F)+N.substring(F+j)):N}o(Te,"_removeImageTag");function ft(N){var M="";return N.reverse().forEach(function(F,j){h.indexOf(F)===-1&&(M+="</"+F+">")}),M}o(ft,"_dumpCloseTag");function $e(N){var M=N.indexOf(" ");if(M===-1&&(M=N.indexOf(">"),M===-1))throw new Error("HTML tag is not well-formed : "+N);return N.substring(1,M)}o($e,"_getTag");function Me(N,M){var F=t-p,j=F,qe=F<n.slop,Ee=qe?F:n.slop-1,Re,dt=qe?0:F-n.slop,ht=M||F+n.slop,ie;if(!n.truncateLastWord){if(Re=N.slice(dt,ht),M&&Re.length<=M)j=Re.length;else for(;(ie=x.exec(Re))!==null;)if(ie.index<Ee){if(j=F-(Ee-ie.index),ie.index===0&&F<=1)break}else if(ie.index===Ee){j=F;break}else{j=F+(ie.index-Ee);break}N.charAt(j-1).match(/\s$/)&&j--}return j}for(o(Me,"_getEndPosition"),n=n||i,n.ellipsis=n.ellipsis!==void 0?n.ellipsis:c,n.truncateLastWord=n.truncateLastWord!==void 0?n.truncateLastWord:!0,n.slop=n.slop!==void 0?n.slop:d;S;){if(S=P.exec(e),!S){if(p>=t)break;if(S=q.exec(e),!S||S.index>=t){f+=e.substring(0,Me(e));break}for(;S;)$=S[0],L=S.index,f+=e.substring(0,L+$.length-p),e=e.substring(L+$.length),S=q.exec(e);break}if($=S[0],L=S.index,p+L>t){f+=e.substring(0,Me(e,L));break}else p+=L,f+=e.substring(0,L);$[1]==="/"?(u.pop(),D=null):(D=_.exec($),D||(z=$e($),u.push(z))),D?f+=D[0]:f+=$,e=e.substring(L+$.length)}return e.length>t-p&&n.ellipsis&&(f+=n.ellipsis),f+=ft(u),n.keepImageTag||(f=Te(f)),f}o(Qr,"truncate");var Zr=Qr;const pn=St({name:"TruncateHtml",props:{htmlText:{type:String,default:""},length:{type:Number,default:100},lessButtonText:{type:String,default:"Show less"},contentCssClass:{type:String,default:""},containerCssClass:{type:String,default:""},buttonCssClass:{type:String,default:""},moreButtonText:{type:String,default:"Show more"}},data(){return{isTruncated:!0,truncatedHtml:Zr(this.htmlText,this.length)}}}),Nt=o((e,t)=>{const n=e.__vccOpts||e;for(const[i,a]of t)n[i]=a;return n},"_export_sfc"),ei=["innerHTML"];function ti(e,t,n,i,a,c){return G(),W("div",{class:je(e.containerCssClass)},[X("div",{class:je([e.isTruncated?"truncated":"",e.contentCssClass]),innerHTML:e.isTruncated?e.truncatedHtml:e.htmlText},null,10,ei),e.truncatedHtml.length<e.htmlText.length?(G(),W("button",{key:0,class:je(e.buttonCssClass),onClick:t[0]||(t[0]=dn(d=>e.isTruncated=!e.isTruncated,["prevent"]))},we(e.isTruncated?e.moreButtonText:e.lessButtonText),3)):be("",!0)],2)}o(ti,"_sfc_render$2");const ni=Nt(pn,[["render",ti]]);pn.__docgenInfo={displayName:"TruncateHtml",exportName:"default",description:"",tags:{},props:[{name:"htmlText",type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"length",type:{name:"number"},defaultValue:{func:!1,value:"100"}},{name:"lessButtonText",type:{name:"string"},defaultValue:{func:!1,value:'"Show less"'}},{name:"contentCssClass",type:{name:"string"},defaultValue:{func:!1,value:'""'}},{name:"containerCssClass",type:{name:"string"},defaultValue:{func:!1,value:'""'}},{name:"buttonCssClass",type:{name:"string"},defaultValue:{func:!1,value:'""'}},{name:"moreButtonText",type:{name:"string"},defaultValue:{func:!1,value:'"Show more"'}}]};const gn=St({name:"NotificationEntry",components:{TruncateHtml:ni},props:{uuid:{type:String,required:!0},state:{type:String,required:!0},sentAt:{type:String,required:!0},payload:{type:String,required:!0},truncateLength:{type:Number,default:60}},emits:["toggle"],computed:{isSent:function(){return this.state==="SENT_STATE"}},mounted(){window.jQuery('[data-toggle="tooltip"]').tooltip({trigger:"hover",placement:"top",container:"body",template:'<div class="tooltip tooltip-notification" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},updated(){window.jQuery(`#notification-${this.uuid}`).tooltip("hide")},beforeUnmount(){window.jQuery(`#notification-${this.uuid}`).tooltip("destroy")}});const ri={class:"notification-dropdown-item"},ii=["id","checked","data-original-title"],si={class:"label label-primary"};function oi(e,t,n,i,a,c){const d=hn("TruncateHtml");return G(),W("li",ri,[X("input",{id:`notification-${e.uuid}`,checked:e.isSent,type:"radio","data-toggle":"tooltip","data-original-title":e.isSent?e.$t("notification.mark_as_read"):e.$t("notification.mark_as_unread"),onClick:t[0]||(t[0]=dn(h=>e.$emit("toggle",e.uuid),["prevent"]))},null,8,ii),X("span",si,we(e.sentAt),1),Xr(d,{"button-css-class":"btn btn-link","container-css-class":"notification-text","content-css-class":e.isSent?"font-bold":"","html-text":e.payload,length:e.truncateLength,"less-button-text":e.$t("notification.show_less"),"more-button-text":e.$t("notification.show_more")},null,8,["content-css-class","html-text","length","less-button-text","more-button-text"])])}o(oi,"_sfc_render$1");const ai=Nt(gn,[["render",oi]]);gn.__docgenInfo={displayName:"NotificationEntry",exportName:"default",description:"",tags:{},props:[{name:"uuid",type:{name:"string"},required:!0},{name:"state",type:{name:"string"},required:!0},{name:"sentAt",type:{name:"string"},required:!0},{name:"payload",type:{name:"string"},required:!0},{name:"truncateLength",type:{name:"number"},defaultValue:{func:!1,value:"60"}}],events:[{name:"toggle"}]};function ci(e){if(document.cookie){const t=document.cookie.split(";");for(let n=0;n<t.length;n++){const i=t[n].trim();if(i.substring(0,e.length+1)===e+"=")return decodeURIComponent(i.substring(e.length+1))}}throw new Error(`No such cookie ${e}`)}o(ci,"getCookie");const mn=St({name:"NotificationViewer",components:{NotificationEntry:ai},props:{baseUrl:{type:String,required:!0},interval:{type:Number,default:300},limit:{type:Number,default:15},truncateLength:{type:Number,default:60}},data(){return{notifications:[],hasNextPage:!1,animationEnabled:!1,pageSize:this.limit,error:"",loading:!0,unreadNotificationsCount:0,timer:0,csrfToken:ci("csrftoken")}},unmounted(){window.clearTimeout(this.timer)},mounted(){this.fetchNotifications(),jQuery(document).on("click.bs.dropdown.data-api",".notification-dropdown",e=>e.stopPropagation())},methods:{fetchNotifications:async function(){const e=await this.doRequest(`?limit=${this.pageSize}`,{},!0);e&&(e.unread_count&&(this.animationEnabled=!0),this.notifications=e.results,this.hasNextPage=!!e.next,this.unreadNotificationsCount=e.unread_count,this.timer=window.setTimeout(()=>void this.fetchNotifications(),this.interval*1e3))},toggleState:async function(e){const t=await this.doRequest(e,{method:"PATCH"});if(!t)return;const n=this.notifications.findIndex(i=>i.uuid===e);this.notifications[n]=t,t.state==="SENT_STATE"?this.unreadNotificationsCount++:this.unreadNotificationsCount--,this.notifications.filter(i=>i.state==="SENT_STATE").length!==this.unreadNotificationsCount&&await this.fetchNotifications()},markAllAsRead:async function(){const e=await this.doRequest("mark_all_as_read",{method:"PUT"});e&&e.length>0&&(this.notifications.forEach(t=>t.state="READ_STATE"),this.unreadNotificationsCount=0)},loadMore:async function(e){e.stopPropagation(),this.loading=!0,this.pageSize+=this.limit,await this.fetchNotifications()},doRequest:async function(e,t,n=!1){n&&(this.loading=!0);try{const i=await fetch(`${this.baseUrl}${e}`,{mode:"same-origin",headers:{"Content-Type":"application/json;charset=utf-8","X-CSRFToken":this.csrfToken},...t});if(i.status>=200&&i.status<300)return n&&(this.loading=!1),i.json();this.error=`${this.$t("notification_viewer.error")}  (${i.statusText})`}catch(i){this.error=`${this.$t("notification_viewer.error")} (${i.message})`}n&&(this.loading=!1)}}});const li={id:"notification-viewer",class:"dropdown"},ui=["data-count"],fi=X("span",{class:"fas fa-bell"},null,-1),di=[fi],hi={class:"dropdown-menu notification-dropdown"},pi={key:0},gi={key:1,role:"separator",class:"divider"},mi={key:2},yi={class:"alert alert-warning",role:"alert"},bi={key:3,role:"separator",class:"divider"},wi={key:4},vi={key:5,class:"progress"},_i={class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"100","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},Ci={class:"sr-only"},Ti={key:6,class:"text-center"};function Ei(e,t,n,i,a,c){const d=hn("NotificationEntry");return G(),W("li",li,[X("a",{class:"dropdown-toggle","data-toggle":"dropdown",role:"button","aria-haspopup":"true","aria-expanded":"false",onClick:t[0]||(t[0]=h=>e.animationEnabled=!1)},[X("div",{class:je(["bell",{"show-count":e.unreadNotificationsCount,notify:e.unreadNotificationsCount&&e.animationEnabled}]),"data-count":e.unreadNotificationsCount},di,10,ui)]),X("ul",hi,[!e.loading&&e.notifications.length?(G(),W("li",pi,[X("a",{class:je(["btn",{disabled:!e.unreadNotificationsCount}]),onClick:t[1]||(t[1]=(...h)=>e.markAllAsRead&&e.markAllAsRead(...h))},we(e.$t("notification_viewer.mark_all_as_read")),3)])):be("",!0),e.error?(G(),W("li",gi)):be("",!0),e.error?(G(),W("li",mi,[X("div",yi,we(e.error),1)])):be("",!0),!e.loading&&e.notifications.length?(G(),W("li",bi)):be("",!0),!e.loading&&!e.notifications.length?(G(),W("li",wi,we(e.$t("notification_viewer.no_notifications")),1)):be("",!0),(G(!0),W(Jr,null,Kr(e.notifications,h=>(G(),Yr(d,{key:h.uuid,uuid:h.uuid,state:h.state,"sent-at":h.sent_at,payload:h.payload,"truncate-length":e.truncateLength,onToggle:e.toggleState},null,8,["uuid","state","sent-at","payload","truncate-length","onToggle"]))),128)),e.loading?(G(),W("li",vi,[X("div",_i,[X("span",Ci,we(e.$t("notification_viewer.loading")),1)])])):e.hasNextPage?(G(),W("li",Ti,[X("button",{type:"button",class:"btn btn-link",onClick:t[2]||(t[2]=(...h)=>e.loadMore&&e.loadMore(...h))},we(e.$t("notification_viewer.load_more")),1)])):be("",!0)])])}o(Ei,"_sfc_render");const at=Nt(mn,[["render",Ei]]);mn.__docgenInfo={displayName:"NotificationViewer",exportName:"default",description:"",tags:{},props:[{name:"baseUrl",type:{name:"string"},required:!0},{name:"interval",type:{name:"number"},defaultValue:{func:!1,value:"300"}},{name:"limit",type:{name:"number"},defaultValue:{func:!1,value:"15"}},{name:"truncateLength",type:{name:"number"},defaultValue:{func:!1,value:"60"}}]};var Qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ri(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}o(Ri,"unwrapExports");function ct(e,t){return t={exports:{}},e(t,t.exports),t.exports}o(ct,"createCommonjsModule");var Ne=1e3,xe=Ne*60,Fe=xe*60,_e=Fe*24,Ai=_e*7,Si=_e*365.25,Ni=o(function(e,t){t=t||{};var n=typeof e;if(n==="string"&&e.length>0)return xi(e);if(n==="number"&&isFinite(e))return t.long?Oi(e):Fi(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},"ms");function xi(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return n*Si;case"weeks":case"week":case"w":return n*Ai;case"days":case"day":case"d":return n*_e;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Fe;case"minutes":case"minute":case"mins":case"min":case"m":return n*xe;case"seconds":case"second":case"secs":case"sec":case"s":return n*Ne;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}o(xi,"parse");function Fi(e){var t=Math.abs(e);return t>=_e?Math.round(e/_e)+"d":t>=Fe?Math.round(e/Fe)+"h":t>=xe?Math.round(e/xe)+"m":t>=Ne?Math.round(e/Ne)+"s":e+"ms"}o(Fi,"fmtShort");function Oi(e){var t=Math.abs(e);return t>=_e?Ze(e,t,_e,"day"):t>=Fe?Ze(e,t,Fe,"hour"):t>=xe?Ze(e,t,xe,"minute"):t>=Ne?Ze(e,t,Ne,"second"):e+" ms"}o(Oi,"fmtLong");function Ze(e,t,n,i){var a=t>=n*1.5;return Math.round(e/n)+" "+i+(a?"s":"")}o(Ze,"plural");function $i(e){n.debug=n,n.default=n,n.coerce=u,n.disable=c,n.enable=a,n.enabled=d,n.humanize=Ni,n.destroy=p,Object.keys(e).forEach(f=>{n[f]=e[f]}),n.names=[],n.skips=[],n.formatters={};function t(f){let m=0;for(let y=0;y<f.length;y++)m=(m<<5)-m+f.charCodeAt(y),m|=0;return n.colors[Math.abs(m)%n.colors.length]}o(t,"selectColor"),n.selectColor=t;function n(f){let m,y=null;function v(..._){if(!v.enabled)return;const P=v,q=Number(new Date),de=q-(m||q);P.diff=de,P.prev=m,P.curr=q,m=q,_[0]=n.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let x=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,($,L)=>{if($==="%%")return"%";x++;const z=n.formatters[L];if(typeof z=="function"){const D=_[x];$=z.call(P,D),_.splice(x,1),x--}return $}),n.formatArgs.call(P,_),(P.log||n.log).apply(P,_)}return o(v,"debug"),v.namespace=f,v.useColors=n.useColors(),v.color=n.selectColor(f),v.extend=i,v.destroy=n.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>y===null?n.enabled(f):y,set:_=>{y=_}}),typeof n.init=="function"&&n.init(v),v}o(n,"createDebug");function i(f,m){const y=n(this.namespace+(typeof m>"u"?":":m)+f);return y.log=this.log,y}o(i,"extend");function a(f){n.save(f),n.names=[],n.skips=[];let m;const y=(typeof f=="string"?f:"").split(/[\s,]+/),v=y.length;for(m=0;m<v;m++)y[m]&&(f=y[m].replace(/\*/g,".*?"),f[0]==="-"?n.skips.push(new RegExp("^"+f.substr(1)+"$")):n.names.push(new RegExp("^"+f+"$")))}o(a,"enable");function c(){const f=[...n.names.map(h),...n.skips.map(h).map(m=>"-"+m)].join(",");return n.enable(""),f}o(c,"disable");function d(f){if(f[f.length-1]==="*")return!0;let m,y;for(m=0,y=n.skips.length;m<y;m++)if(n.skips[m].test(f))return!1;for(m=0,y=n.names.length;m<y;m++)if(n.names[m].test(f))return!0;return!1}o(d,"enabled");function h(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}o(h,"toNamespace");function u(f){return f instanceof Error?f.stack||f.message:f}o(u,"coerce");function p(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return o(p,"destroy"),n.enable(n.load()),n}o($i,"setup");var Mi=$i,Y=ct(function(e,t){t.formatArgs=i,t.save=a,t.load=c,t.useColors=n,t.storage=d(),t.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}o(n,"useColors");function i(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;u.splice(1,0,p,"color: inherit");let f=0,m=0;u[0].replace(/%[a-zA-Z%]/g,y=>{y!=="%%"&&(f++,y==="%c"&&(m=f))}),u.splice(m,0,p)}o(i,"formatArgs"),t.log=console.debug||console.log||(()=>{});function a(u){try{u?t.storage.setItem("debug",u):t.storage.removeItem("debug")}catch{}}o(a,"save");function c(){let u;try{u=t.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u={}.DEBUG),u}o(c,"load");function d(){try{return localStorage}catch{}}o(d,"localstorage"),e.exports=Mi(t);const{formatters:h}=e.exports;h.j=function(u){try{return JSON.stringify(u)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}});Y.formatArgs;Y.save;Y.load;Y.useColors;Y.storage;Y.destroy;Y.colors;Y.log;let yn,nt="default",Tt="";const Et=o(()=>{yn=Y(Tt?`fetch-mock:${nt}:${Tt}`:`fetch-mock:${nt}`)},"newDebug"),ki=o(e=>Y(`fetch-mock:${nt}:${e}`),"newDebugSandbox");Et();var Ce={debug:(...e)=>{yn(...e)},setDebugNamespace:e=>{Tt=e,Et()},setDebugPhase:e=>{nt=e||"default",Et()},getDebug:e=>ki(e)};const{debug:Pi,setDebugPhase:bn}=Ce,J={};J.mock=function(...e){return bn("setup"),e.length&&this.addRoute(e),this._mock()};J.addRoute=function(e){Pi("Adding route",e);const t=this.compileRoute(e),n=this.routes.filter(({identifier:i,method:a})=>(typeof i=="function"?i===t.identifier:String(i)===String(t.identifier))&&(!a||!t.method||a===t.method));if(this.getOption("overwriteRoutes",t)===!1||!n.length)return this._uncompiledRoutes.push(e),this.routes.push(t);if(this.getOption("overwriteRoutes",t)===!0)return n.forEach(i=>{const a=this.routes.indexOf(i);this._uncompiledRoutes.splice(a,1,e),this.routes.splice(a,1,t)}),this.routes;if(n.length)throw new Error("fetch-mock: Adding route with same name or matcher as existing route. See `overwriteRoutes` option.");this._uncompiledRoutes.push(e),this.routes.push(t)};J._mock=function(){return this.isSandbox||(this.realFetch=this.realFetch||this.global.fetch,this.global.fetch=this.fetchHandler),bn(),this};J.catch=function(e){return this.fallbackResponse&&console.warn("calling fetchMock.catch() twice - are you sure you want to overwrite the previous fallback response"),this.fallbackResponse=e||"ok",this._mock()};J.spy=function(e){return this._mock(),e?this.mock(e,this.getNativeFetch()):this.catch(this.getNativeFetch())};const rt=o((e,t,n)=>{J[e]=function(i,a,c){return this[t](i,a,Object.assign(c||{},n))}},"defineShorthand"),it=o((e,t)=>{J[e]=function(n,i){return this[t]({},n,i)}},"defineGreedyShorthand");rt("sticky","mock",{sticky:!0});rt("once","mock",{repeat:1});it("any","mock");it("anyOnce","once");["get","post","put","delete","head","patch"].forEach(e=>{rt(e,"mock",{method:e}),rt(`${e}Once`,"once",{method:e}),it(`${e}Any`,e),it(`${e}AnyOnce`,`${e}Once`)});const Li=o(e=>{typeof e=="function"&&(console.warn("Deprecated: Passing fetch-mock reset methods\ndirectly in as handlers for before/after test runner hooks.\nWrap in an arrow function instead e.g. `() => fetchMock.restore()`"),e())},"mochaAsyncHookWorkaround"),Ui=o(({sticky:e})=>t=>e?[]:t.filter(({sticky:n})=>n),"getRouteRemover");J.resetBehavior=function(e={}){Li(e);const t=Ui(e);return this.routes=t(this.routes),this._uncompiledRoutes=t(this._uncompiledRoutes),this.realFetch&&!this.routes.length&&(this.global.fetch=this.realFetch,this.realFetch=void 0),this.fallbackResponse=void 0,this};J.resetHistory=function(){return this._calls=[],this._holdingPromises=[],this.routes.forEach(e=>e.reset&&e.reset()),this};J.restore=J.reset=function(e){return this.resetBehavior(e),this.resetHistory(),this};var Ii=J;const{getDebug:Di}=Ce,nn=["body","headers","throws","status","redirectUrl"];class wn{constructor(t){this.debug=Di("ResponseBuilder()"),this.debug("Response builder created with options",t),Object.assign(this,t)}exec(){this.debug("building response"),this.normalizeResponseConfig(),this.constructFetchOpts(),this.constructResponseBody();const t=new this.fetchMock.config.Response(this.body,this.options),n=this.buildObservableResponse(t);return[t,n]}sendAsObject(){return nn.some(t=>this.responseConfig[t])?!Object.keys(this.responseConfig).every(t=>nn.includes(t)):!0}normalizeResponseConfig(){typeof this.responseConfig=="number"?(this.debug("building response using status",this.responseConfig),this.responseConfig={status:this.responseConfig}):(typeof this.responseConfig=="string"||this.sendAsObject())&&(this.debug("building text response from",this.responseConfig),this.responseConfig={body:this.responseConfig})}validateStatus(t){if(!t)return this.debug("No status provided. Defaulting to 200"),200;if(typeof t=="number"&&parseInt(t,10)!==t&&t>=200||t<600)return this.debug("Valid status provided",t),t;throw new TypeError(`fetch-mock: Invalid status ${t} passed on response object.
To respond with a JSON object that has status as a property assign the object to body
e.g. {"body": {"status: "registered"}}`)}constructFetchOpts(){this.options=this.responseConfig.options||{},this.options.url=this.responseConfig.redirectUrl||this.url,this.options.status=this.validateStatus(this.responseConfig.status),this.options.statusText=this.fetchMock.statusTextMap[String(this.options.status)],this.options.headers=new this.fetchMock.config.Headers(this.responseConfig.headers||{})}getOption(t){return this.fetchMock.getOption(t,this.route)}convertToJson(){this.getOption("sendAsJson")&&this.responseConfig.body!=null&&typeof this.body=="object"&&(this.debug("Stringifying JSON response body"),this.body=JSON.stringify(this.body),this.options.headers.has("Content-Type")||this.options.headers.set("Content-Type","application/json"))}setContentLength(){this.getOption("includeContentLength")&&typeof this.body=="string"&&!this.options.headers.has("Content-Length")&&(this.debug("Setting content-length header:",this.body.length.toString()),this.options.headers.set("Content-Length",this.body.length.toString()))}constructResponseBody(){if(this.body=this.responseConfig.body,this.convertToJson(),this.setContentLength(),this.Stream){this.debug("Creating response stream");const t=new this.Stream.Readable;this.body!=null&&t.push(this.body,"utf-8"),t.push(null),this.body=t}this.body=this.body}buildObservableResponse(t){const n=this.fetchMock;return t._fmResults={},this.debug("Wrapping Response in ES proxy for observability"),new Proxy(t,{get:(i,a)=>{if(this.responseConfig.redirectUrl){if(a==="url")return this.debug("Retrieving redirect url",this.responseConfig.redirectUrl),this.responseConfig.redirectUrl;if(a==="redirected")return this.debug("Retrieving redirected status",!0),!0}return typeof i[a]=="function"?(this.debug("Wrapping body promises in ES proxies for observability"),new Proxy(i[a],{apply:(c,d,h)=>{this.debug(`Calling res.${a}`);const u=c.apply(t,h);return u.then&&(n._holdingPromises.push(u.catch(()=>null)),i._fmResults[a]=u),u}})):i[a]}})}}o(wn,"ResponseBuilder");var ji=o(e=>new wn(e).exec(),"responseBuilder");let le;const Rt=new RegExp("^[a-z]+://","i"),Bi=new RegExp("^//","i"),rn=o(e=>typeof e.raw=="function"?Object.entries(e.raw()):e[Symbol.iterator]?[...e]:Object.entries(e),"headersToArray"),sn=o(e=>e.reduce((t,[n,i])=>Object.assign(t,{[n]:i}),{}),"zipObject"),Ct=o(e=>{if(typeof e=="function"||e instanceof RegExp||/^(begin|end|glob|express|path)\:/.test(e))return e;if(Rt.test(e))return new le(e).href;if(Bi.test(e))return new le(e,"http://dummy").href;{const t=new le(e,"http://dummy");return t.pathname+t.search}},"normalizeUrl"),Gi=o(async e=>{try{return"body"in e?e.body.toString():e.clone().text()}catch{}},"extractBody");var lt={setUrlImplementation:e=>{le=e},normalizeRequest:(e,t,n)=>{if(n.prototype.isPrototypeOf(e)){const i={method:e.method},a=Gi(e);typeof a<"u"&&(i.body=a);const c={url:Ct(e.url),options:Object.assign(i,t),request:e,signal:t&&t.signal||e.signal},d=rn(e.headers);return d.length&&(c.options.headers=sn(d)),c}else{if(typeof e=="string"||typeof e=="object"&&"href"in e)return{url:Ct(e),options:t,signal:t&&t.signal};throw typeof e=="object"?new TypeError("fetch-mock: Unrecognised Request object. Read the Config and Installation sections of the docs"):new TypeError("fetch-mock: Invalid arguments passed to fetch")}},normalizeUrl:Ct,getPath:e=>(Rt.test(e)?new le(e):new le(e,"http://dummy")).pathname,getQuery:e=>{const t=Rt.test(e)?new le(e):new le(e,"http://dummy");return t.search?t.search.substr(1):""},headers:{normalize:e=>sn(rn(e)),toLowerCase:e=>Object.keys(e).reduce((t,n)=>(t[n.toLowerCase()]=e[n],t),{}),equal:(e,t)=>(e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t],e.length!==t.length?!1:e.every((n,i)=>n===t[i]))}};const{debug:Be,setDebugPhase:vn,getDebug:ut}=Ce,Q={};class _n extends Error{constructor(){super(...arguments),this.name="AbortError",this.message="The operation was aborted.",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}o(_n,"AbortError");const qi=o(e=>typeof navigator>"u"||!navigator.vendor||navigator.vendor!=="Apple Computer, Inc."?e:async t=>{const{method:n}=t;if(!["POST","PUT","PATCH"].includes(n))return e(t);const i=await t.clone().text(),{cache:a,credentials:c,headers:d,integrity:h,mode:u,redirect:p,referrer:f}=t,m={body:i,cache:a,credentials:c,headers:d,integrity:h,mode:u,redirect:p,referrer:f,method:n};return e(t.url,m)},"patchNativeFetchForSafari"),zi=o(async({response:e,responseIsFetch:t=!1},n,i,a)=>{const c=ut("resolve()");for(c("Recursively resolving function and promise responses");;)if(typeof e=="function"){if(c("  Response is a function"),t)return a?(c("  -> Calling fetch with Request instance"),e(a)):(c("  -> Calling fetch with url and options"),e(n,i));c("  -> Calling response function"),e=e(n,i,a)}else if(typeof e.then=="function")c("  Response is a promise"),c("  -> Resolving promise"),e=await e;else return c("  Response is not a function or a promise"),c("  -> Exiting response resolution recursion"),e},"resolve");Q.needsAsyncBodyExtraction=function({request:e}){return e&&this.routes.some(({usesBody:t})=>t)};Q.fetchHandler=function(e,t){vn("handle");const n=ut("fetchHandler()");n("fetch called with:",e,t);const i=lt.normalizeRequest(e,t,this.config.Request);return n("Request normalised"),n("  url",i.url),n("  options",i.options),n("  request",i.request),n("  signal",i.signal),this.needsAsyncBodyExtraction(i)?(n("Need to wait for Body to be streamed before calling router: switching to async mode"),this._extractBodyThenHandle(i)):this._fetchHandler(i)};Q._extractBodyThenHandle=async function(e){return e.options.body=await e.options.body,this._fetchHandler(e)};Q._fetchHandler=function({url:e,options:t,request:n,signal:i}){const{route:a,callLog:c}=this.executeRouter(e,t,n);this.recordCall(c);let d;return this._holdingPromises.push(new this.config.Promise(h=>d=h)),new this.config.Promise((h,u)=>{if(i){Be("signal exists - enabling fetch abort");const p=o(()=>{Be("aborting fetch"),u(typeof DOMException<"u"?new DOMException("The operation was aborted.","AbortError"):new _n),d()},"abort");i.aborted&&(Be("signal is already aborted - aborting the fetch"),p()),i.addEventListener("abort",p)}this.generateResponse({route:a,url:e,options:t,request:n,callLog:c}).then(h,u).then(d,d).then(()=>{vn()})})};Q.fetchHandler.isMock=!0;Q.executeRouter=function(e,t,n){const i=ut("executeRouter()"),a={url:e,options:t,request:n,isUnmatched:!0};if(i("Attempting to match request to a route"),this.getOption("fallbackToNetwork")==="always")return i("  Configured with fallbackToNetwork=always - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0}};const c=this.router(e,t,n);if(c)return i("  Matching route found"),{route:c,callLog:{url:e,options:t,request:n,identifier:c.identifier}};if(this.getOption("warnOnFallback")&&console.warn(`Unmatched ${t&&t.method||"GET"} to ${e}`),this.fallbackResponse)return i("  No matching route found - using fallbackResponse"),{route:{response:this.fallbackResponse},callLog:a};if(!this.getOption("fallbackToNetwork"))throw new Error(`fetch-mock: No fallback response defined for ${t&&t.method||"GET"} to ${e}`);return i("  Configured to fallbackToNetwork - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0},callLog:a}};Q.generateResponse=async function({route:e,url:t,options:n,request:i,callLog:a={}}){const c=ut("generateResponse()"),d=await zi(e,t,n,i);if(d.throws&&typeof d!="function")throw c("response.throws is defined - throwing an error"),d.throws;if(this.config.Response.prototype.isPrototypeOf(d))return c("response is already a Response instance - returning it"),a.response=d,d;const[h,u]=ji({url:t,responseConfig:d,fetchMock:this,route:e});return a.response=h,u};Q.router=function(e,t,n){const i=this.routes.find((a,c)=>(Be(`Trying to match route ${c}`),a.matcher(e,t,n)));if(i)return i};Q.getNativeFetch=function(){const e=this.realFetch||this.isSandbox&&this.config.fetch;if(!e)throw new Error("fetch-mock: Falling back to network only available on global fetch-mock, or by setting config.fetch on sandboxed fetch-mock");return qi(e)};Q.recordCall=function(e){Be("Recording fetch call",e),e&&this._calls.push(e)};var Hi=Q,Vi=o(function(e,t){if(typeof e!="string")throw new TypeError("Expected a string");for(var n=String(e),i="",a=t?!!t.extended:!1,c=t?!!t.globstar:!1,d=!1,h=t&&typeof t.flags=="string"?t.flags:"",u,p=0,f=n.length;p<f;p++)switch(u=n[p],u){case"/":case"$":case"^":case"+":case".":case"(":case")":case"=":case"!":case"|":i+="\\"+u;break;case"?":if(a){i+=".";break}case"[":case"]":if(a){i+=u;break}case"{":if(a){d=!0,i+="(";break}case"}":if(a){d=!1,i+=")";break}case",":if(d){i+="|";break}i+="\\"+u;break;case"*":for(var m=n[p-1],y=1;n[p+1]==="*";)y++,p++;var v=n[p+1];if(!c)i+=".*";else{var _=y>1&&(m==="/"||m===void 0)&&(v==="/"||v===void 0);_?(i+="((?:[^/]*(?:/|$))*)",p++):i+="([^/]*)"}break;default:i+=u}return(!h||!~h.indexOf("g"))&&(i="^"+i+"$"),new RegExp(i,h)},"globToRegexp"),Oe=Sn,Wi=xt,Xi=Qi,Ji=En,Ki=An,Cn="/",Tn="./",Yi=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function xt(e,t){for(var n=[],i=0,a=0,c="",d=t&&t.delimiter||Cn,h=t&&t.delimiters||Tn,u=!1,p;(p=Yi.exec(e))!==null;){var f=p[0],m=p[1],y=p.index;if(c+=e.slice(a,y),a=y+f.length,m){c+=m[1],u=!0;continue}var v="",_=e[a],P=p[2],q=p[3],de=p[4],x=p[5];if(!u&&c.length){var S=c.length-1;h.indexOf(c[S])>-1&&(v=c[S],c=c.slice(0,S))}c&&(n.push(c),c="",u=!1);var $=v!==""&&_!==void 0&&_!==v,L=x==="+"||x==="*",z=x==="?"||x==="*",D=v||d,Te=q||de;n.push({name:P||i++,prefix:v,delimiter:D,optional:z,repeat:L,partial:$,pattern:Te?Zi(Te):"[^"+ce(D)+"]+?"})}return(c||a<e.length)&&n.push(c+e.substr(a)),n}o(xt,"parse$1");function Qi(e,t){return En(xt(e,t))}o(Qi,"compile");function En(e){for(var t=new Array(e.length),n=0;n<e.length;n++)typeof e[n]=="object"&&(t[n]=new RegExp("^(?:"+e[n].pattern+")$"));return function(i,a){for(var c="",d=a&&a.encode||encodeURIComponent,h=0;h<e.length;h++){var u=e[h];if(typeof u=="string"){c+=u;continue}var p=i?i[u.name]:void 0,f;if(Array.isArray(p)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but got array');if(p.length===0){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var m=0;m<p.length;m++){if(f=d(p[m],u),!t[h].test(f))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'"');c+=(m===0?u.prefix:u.delimiter)+f}continue}if(typeof p=="string"||typeof p=="number"||typeof p=="boolean"){if(f=d(String(p),u),!t[h].test(f))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but got "'+f+'"');c+=u.prefix+f;continue}if(u.optional){u.partial&&(c+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be '+(u.repeat?"an array":"a string"))}return c}}o(En,"tokensToFunction");function ce(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}o(ce,"escapeString");function Zi(e){return e.replace(/([=!:$/()])/g,"\\$1")}o(Zi,"escapeGroup");function Rn(e){return e&&e.sensitive?"":"i"}o(Rn,"flags");function es(e,t){if(!t)return e;var n=e.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return e}o(es,"regexpToRegexp");function ts(e,t,n){for(var i=[],a=0;a<e.length;a++)i.push(Sn(e[a],t,n).source);return new RegExp("(?:"+i.join("|")+")",Rn(n))}o(ts,"arrayToRegexp");function ns(e,t,n){return An(xt(e,n),t,n)}o(ns,"stringToRegexp");function An(e,t,n){n=n||{};for(var i=n.strict,a=n.start!==!1,c=n.end!==!1,d=ce(n.delimiter||Cn),h=n.delimiters||Tn,u=[].concat(n.endsWith||[]).map(ce).concat("$").join("|"),p=a?"^":"",f=e.length===0,m=0;m<e.length;m++){var y=e[m];if(typeof y=="string")p+=ce(y),f=m===e.length-1&&h.indexOf(y[y.length-1])>-1;else{var v=y.repeat?"(?:"+y.pattern+")(?:"+ce(y.delimiter)+"(?:"+y.pattern+"))*":y.pattern;t&&t.push(y),y.optional?y.partial?p+=ce(y.prefix)+"("+v+")?":p+="(?:"+ce(y.prefix)+"("+v+"))?":p+=ce(y.prefix)+"("+v+")"}}return c?(i||(p+="(?:"+d+")?"),p+=u==="$"?"$":"(?="+u+")"):(i||(p+="(?:"+d+"(?="+u+"))?"),f||(p+="(?="+d+"|"+u+")")),new RegExp(p,Rn(n))}o(An,"tokensToRegExp");function Sn(e,t,n){return e instanceof RegExp?es(e,t):Array.isArray(e)?ts(e,t,n):ns(e,t,n)}o(Sn,"pathToRegexp");Oe.parse=Wi;Oe.compile=Xi;Oe.tokensToFunction=Ji;Oe.tokensToRegExp=Ki;function rs(e,t){return Object.prototype.hasOwnProperty.call(e,t)}o(rs,"hasOwnProperty");var is=o(function(e,t,n,i){t=t||"&",n=n||"=";var a={};if(typeof e!="string"||e.length===0)return a;var c=/\+/g;e=e.split(t);var d=1e3;i&&typeof i.maxKeys=="number"&&(d=i.maxKeys);var h=e.length;d>0&&h>d&&(h=d);for(var u=0;u<h;++u){var p=e[u].replace(c,"%20"),f=p.indexOf(n),m,y,v,_;f>=0?(m=p.substr(0,f),y=p.substr(f+1)):(m=p,y=""),v=decodeURIComponent(m),_=decodeURIComponent(y),rs(a,v)?Array.isArray(a[v])?a[v].push(_):a[v]=[a[v],_]:a[v]=_}return a},"decode"),Ie=o(function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},"stringifyPrimitive"),ss=o(function(e,t,n,i){return t=t||"&",n=n||"=",e===null&&(e=void 0),typeof e=="object"?Object.keys(e).map(function(a){var c=encodeURIComponent(Ie(a))+n;return Array.isArray(e[a])?e[a].map(function(d){return c+encodeURIComponent(Ie(d))}).join(t):c+encodeURIComponent(Ie(e[a]))}).join(t):i?encodeURIComponent(Ie(i))+n+encodeURIComponent(Ie(e)):""},"encode"),ve=ct(function(e,t){t.decode=t.parse=is,t.encode=t.stringify=ss});ve.decode;ve.parse;ve.encode;ve.stringify;var Nn=ct(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(i){function a(c,d){return i.apply(this,arguments)}return o(a,"isSubset"),a.toString=function(){return i.toString()},a}(function(i,a){return typeof i!="object"||i===null||typeof a!="object"||a===null?!1:Object.keys(a).every(function(c){if(!i.propertyIsEnumerable(c))return!1;var d=a[c],h=i[c];return!(typeof d=="object"&&d!==null?!n(h,d):h!==d)})});t.default=n,e.exports=t.default});Ri(Nn);var xn=ct(function(e,t){var n=200,i="__lodash_hash_undefined__",a=1,c=2,d=9007199254740991,h="[object Arguments]",u="[object Array]",p="[object AsyncFunction]",f="[object Boolean]",m="[object Date]",y="[object Error]",v="[object Function]",_="[object GeneratorFunction]",P="[object Map]",q="[object Number]",de="[object Null]",x="[object Object]",S="[object Promise]",$="[object Proxy]",L="[object RegExp]",z="[object Set]",D="[object String]",Te="[object Symbol]",ft="[object Undefined]",$e="[object WeakMap]",Me="[object ArrayBuffer]",N="[object DataView]",M="[object Float32Array]",F="[object Float64Array]",j="[object Int8Array]",qe="[object Int16Array]",Ee="[object Int32Array]",Re="[object Uint8Array]",dt="[object Uint8ClampedArray]",ht="[object Uint16Array]",ie="[object Uint32Array]",Mn=/[\\^$.*+?()[\]{}|]/g,kn=/^\[object .+?Constructor\]$/,Pn=/^(?:0|[1-9]\d*)$/,T={};T[M]=T[F]=T[j]=T[qe]=T[Ee]=T[Re]=T[dt]=T[ht]=T[ie]=!0,T[h]=T[u]=T[Me]=T[f]=T[N]=T[m]=T[y]=T[v]=T[P]=T[q]=T[x]=T[L]=T[z]=T[D]=T[$e]=!1;var $t=typeof Qe=="object"&&Qe&&Qe.Object===Object&&Qe,Ln=typeof self=="object"&&self&&self.Object===Object&&self,te=$t||Ln||Function("return this")(),Mt=t&&!t.nodeType&&t,kt=Mt&&!0&&e&&!e.nodeType&&e,Pt=kt&&kt.exports===Mt,pt=Pt&&$t.process,Lt=function(){try{return pt&&pt.binding&&pt.binding("util")}catch{}}(),Ut=Lt&&Lt.isTypedArray;function Un(r,s){for(var l=-1,g=r==null?0:r.length,E=0,w=[];++l<g;){var A=r[l];s(A,l,r)&&(w[E++]=A)}return w}o(Un,"arrayFilter");function In(r,s){for(var l=-1,g=s.length,E=r.length;++l<g;)r[E+l]=s[l];return r}o(In,"arrayPush");function Dn(r,s){for(var l=-1,g=r==null?0:r.length;++l<g;)if(s(r[l],l,r))return!0;return!1}o(Dn,"arraySome");function jn(r,s){for(var l=-1,g=Array(r);++l<r;)g[l]=s(l);return g}o(jn,"baseTimes");function Bn(r){return function(s){return r(s)}}o(Bn,"baseUnary");function Gn(r,s){return r.has(s)}o(Gn,"cacheHas");function qn(r,s){return r==null?void 0:r[s]}o(qn,"getValue");function zn(r){var s=-1,l=Array(r.size);return r.forEach(function(g,E){l[++s]=[E,g]}),l}o(zn,"mapToArray");function Hn(r,s){return function(l){return r(s(l))}}o(Hn,"overArg");function Vn(r){var s=-1,l=Array(r.size);return r.forEach(function(g){l[++s]=g}),l}o(Vn,"setToArray");var Wn=Array.prototype,Xn=Function.prototype,ze=Object.prototype,gt=te["__core-js_shared__"],It=Xn.toString,Z=ze.hasOwnProperty,Dt=function(){var r=/[^.]+$/.exec(gt&&gt.keys&&gt.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),jt=ze.toString,Jn=RegExp("^"+It.call(Z).replace(Mn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bt=Pt?te.Buffer:void 0,He=te.Symbol,Gt=te.Uint8Array,qt=ze.propertyIsEnumerable,Kn=Wn.splice,he=He?He.toStringTag:void 0,zt=Object.getOwnPropertySymbols,Yn=Bt?Bt.isBuffer:void 0,Qn=Hn(Object.keys,Object),mt=Ae(te,"DataView"),ke=Ae(te,"Map"),yt=Ae(te,"Promise"),bt=Ae(te,"Set"),wt=Ae(te,"WeakMap"),Pe=Ae(Object,"create"),Zn=me(mt),er=me(ke),tr=me(yt),nr=me(bt),rr=me(wt),Ht=He?He.prototype:void 0,vt=Ht?Ht.valueOf:void 0;function pe(r){var s=-1,l=r==null?0:r.length;for(this.clear();++s<l;){var g=r[s];this.set(g[0],g[1])}}o(pe,"Hash");function ir(){this.__data__=Pe?Pe(null):{},this.size=0}o(ir,"hashClear");function sr(r){var s=this.has(r)&&delete this.__data__[r];return this.size-=s?1:0,s}o(sr,"hashDelete");function or(r){var s=this.__data__;if(Pe){var l=s[r];return l===i?void 0:l}return Z.call(s,r)?s[r]:void 0}o(or,"hashGet");function ar(r){var s=this.__data__;return Pe?s[r]!==void 0:Z.call(s,r)}o(ar,"hashHas");function cr(r,s){var l=this.__data__;return this.size+=this.has(r)?0:1,l[r]=Pe&&s===void 0?i:s,this}o(cr,"hashSet"),pe.prototype.clear=ir,pe.prototype.delete=sr,pe.prototype.get=or,pe.prototype.has=ar,pe.prototype.set=cr;function ne(r){var s=-1,l=r==null?0:r.length;for(this.clear();++s<l;){var g=r[s];this.set(g[0],g[1])}}o(ne,"ListCache");function lr(){this.__data__=[],this.size=0}o(lr,"listCacheClear");function ur(r){var s=this.__data__,l=We(s,r);if(l<0)return!1;var g=s.length-1;return l==g?s.pop():Kn.call(s,l,1),--this.size,!0}o(ur,"listCacheDelete");function fr(r){var s=this.__data__,l=We(s,r);return l<0?void 0:s[l][1]}o(fr,"listCacheGet");function dr(r){return We(this.__data__,r)>-1}o(dr,"listCacheHas");function hr(r,s){var l=this.__data__,g=We(l,r);return g<0?(++this.size,l.push([r,s])):l[g][1]=s,this}o(hr,"listCacheSet"),ne.prototype.clear=lr,ne.prototype.delete=ur,ne.prototype.get=fr,ne.prototype.has=dr,ne.prototype.set=hr;function ge(r){var s=-1,l=r==null?0:r.length;for(this.clear();++s<l;){var g=r[s];this.set(g[0],g[1])}}o(ge,"MapCache");function pr(){this.size=0,this.__data__={hash:new pe,map:new(ke||ne),string:new pe}}o(pr,"mapCacheClear");function gr(r){var s=Xe(this,r).delete(r);return this.size-=s?1:0,s}o(gr,"mapCacheDelete");function mr(r){return Xe(this,r).get(r)}o(mr,"mapCacheGet");function yr(r){return Xe(this,r).has(r)}o(yr,"mapCacheHas");function br(r,s){var l=Xe(this,r),g=l.size;return l.set(r,s),this.size+=l.size==g?0:1,this}o(br,"mapCacheSet"),ge.prototype.clear=pr,ge.prototype.delete=gr,ge.prototype.get=mr,ge.prototype.has=yr,ge.prototype.set=br;function Ve(r){var s=-1,l=r==null?0:r.length;for(this.__data__=new ge;++s<l;)this.add(r[s])}o(Ve,"SetCache");function wr(r){return this.__data__.set(r,i),this}o(wr,"setCacheAdd");function vr(r){return this.__data__.has(r)}o(vr,"setCacheHas"),Ve.prototype.add=Ve.prototype.push=wr,Ve.prototype.has=vr;function se(r){var s=this.__data__=new ne(r);this.size=s.size}o(se,"Stack");function _r(){this.__data__=new ne,this.size=0}o(_r,"stackClear");function Cr(r){var s=this.__data__,l=s.delete(r);return this.size=s.size,l}o(Cr,"stackDelete");function Tr(r){return this.__data__.get(r)}o(Tr,"stackGet");function Er(r){return this.__data__.has(r)}o(Er,"stackHas");function Rr(r,s){var l=this.__data__;if(l instanceof ne){var g=l.__data__;if(!ke||g.length<n-1)return g.push([r,s]),this.size=++l.size,this;l=this.__data__=new ge(g)}return l.set(r,s),this.size=l.size,this}o(Rr,"stackSet"),se.prototype.clear=_r,se.prototype.delete=Cr,se.prototype.get=Tr,se.prototype.has=Er,se.prototype.set=Rr;function Ar(r,s){var l=Je(r),g=!l&&Br(r),E=!l&&!g&&_t(r),w=!l&&!g&&!E&&en(r),A=l||g||E||w,O=A?jn(r.length,String):[],k=O.length;for(var R in r)(s||Z.call(r,R))&&!(A&&(R=="length"||E&&(R=="offset"||R=="parent")||w&&(R=="buffer"||R=="byteLength"||R=="byteOffset")||Lr(R,k)))&&O.push(R);return O}o(Ar,"arrayLikeKeys");function We(r,s){for(var l=r.length;l--;)if(Kt(r[l][0],s))return l;return-1}o(We,"assocIndexOf");function Sr(r,s,l){var g=s(r);return Je(r)?g:In(g,l(r))}o(Sr,"baseGetAllKeys");function Le(r){return r==null?r===void 0?ft:de:he&&he in Object(r)?kr(r):jr(r)}o(Le,"baseGetTag");function Vt(r){return Ue(r)&&Le(r)==h}o(Vt,"baseIsArguments");function Wt(r,s,l,g,E){return r===s?!0:r==null||s==null||!Ue(r)&&!Ue(s)?r!==r&&s!==s:Nr(r,s,l,g,Wt,E)}o(Wt,"baseIsEqual");function Nr(r,s,l,g,E,w){var A=Je(r),O=Je(s),k=A?u:oe(r),R=O?u:oe(s);k=k==h?x:k,R=R==h?x:R;var B=k==x,K=R==x,U=k==R;if(U&&_t(r)){if(!_t(s))return!1;A=!0,B=!1}if(U&&!B)return w||(w=new se),A||en(r)?Xt(r,s,l,g,E,w):$r(r,s,k,l,g,E,w);if(!(l&a)){var H=B&&Z.call(r,"__wrapped__"),V=K&&Z.call(s,"__wrapped__");if(H||V){var ae=H?r.value():r,re=V?s.value():s;return w||(w=new se),E(ae,re,l,g,w)}}return U?(w||(w=new se),Mr(r,s,l,g,E,w)):!1}o(Nr,"baseIsEqualDeep");function xr(r){if(!Zt(r)||Ir(r))return!1;var s=Yt(r)?Jn:kn;return s.test(me(r))}o(xr,"baseIsNative");function Fr(r){return Ue(r)&&Qt(r.length)&&!!T[Le(r)]}o(Fr,"baseIsTypedArray");function Or(r){if(!Dr(r))return Qn(r);var s=[];for(var l in Object(r))Z.call(r,l)&&l!="constructor"&&s.push(l);return s}o(Or,"baseKeys");function Xt(r,s,l,g,E,w){var A=l&a,O=r.length,k=s.length;if(O!=k&&!(A&&k>O))return!1;var R=w.get(r);if(R&&w.get(s))return R==s;var B=-1,K=!0,U=l&c?new Ve:void 0;for(w.set(r,s),w.set(s,r);++B<O;){var H=r[B],V=s[B];if(g)var ae=A?g(V,H,B,s,r,w):g(H,V,B,r,s,w);if(ae!==void 0){if(ae)continue;K=!1;break}if(U){if(!Dn(s,function(re,ye){if(!Gn(U,ye)&&(H===re||E(H,re,l,g,w)))return U.push(ye)})){K=!1;break}}else if(!(H===V||E(H,V,l,g,w))){K=!1;break}}return w.delete(r),w.delete(s),K}o(Xt,"equalArrays");function $r(r,s,l,g,E,w,A){switch(l){case N:if(r.byteLength!=s.byteLength||r.byteOffset!=s.byteOffset)return!1;r=r.buffer,s=s.buffer;case Me:return!(r.byteLength!=s.byteLength||!w(new Gt(r),new Gt(s)));case f:case m:case q:return Kt(+r,+s);case y:return r.name==s.name&&r.message==s.message;case L:case D:return r==s+"";case P:var O=zn;case z:var k=g&a;if(O||(O=Vn),r.size!=s.size&&!k)return!1;var R=A.get(r);if(R)return R==s;g|=c,A.set(r,s);var B=Xt(O(r),O(s),g,E,w,A);return A.delete(r),B;case Te:if(vt)return vt.call(r)==vt.call(s)}return!1}o($r,"equalByTag");function Mr(r,s,l,g,E,w){var A=l&a,O=Jt(r),k=O.length,R=Jt(s),B=R.length;if(k!=B&&!A)return!1;for(var K=k;K--;){var U=O[K];if(!(A?U in s:Z.call(s,U)))return!1}var H=w.get(r);if(H&&w.get(s))return H==s;var V=!0;w.set(r,s),w.set(s,r);for(var ae=A;++K<k;){U=O[K];var re=r[U],ye=s[U];if(g)var tn=A?g(ye,re,U,s,r,w):g(re,ye,U,r,s,w);if(!(tn===void 0?re===ye||E(re,ye,l,g,w):tn)){V=!1;break}ae||(ae=U=="constructor")}if(V&&!ae){var Ke=r.constructor,Ye=s.constructor;Ke!=Ye&&"constructor"in r&&"constructor"in s&&!(typeof Ke=="function"&&Ke instanceof Ke&&typeof Ye=="function"&&Ye instanceof Ye)&&(V=!1)}return w.delete(r),w.delete(s),V}o(Mr,"equalObjects");function Jt(r){return Sr(r,zr,Pr)}o(Jt,"getAllKeys");function Xe(r,s){var l=r.__data__;return Ur(s)?l[typeof s=="string"?"string":"hash"]:l.map}o(Xe,"getMapData");function Ae(r,s){var l=qn(r,s);return xr(l)?l:void 0}o(Ae,"getNative");function kr(r){var s=Z.call(r,he),l=r[he];try{r[he]=void 0;var g=!0}catch{}var E=jt.call(r);return g&&(s?r[he]=l:delete r[he]),E}o(kr,"getRawTag");var Pr=zt?function(r){return r==null?[]:(r=Object(r),Un(zt(r),function(s){return qt.call(r,s)}))}:Hr,oe=Le;(mt&&oe(new mt(new ArrayBuffer(1)))!=N||ke&&oe(new ke)!=P||yt&&oe(yt.resolve())!=S||bt&&oe(new bt)!=z||wt&&oe(new wt)!=$e)&&(oe=o(function(r){var s=Le(r),l=s==x?r.constructor:void 0,g=l?me(l):"";if(g)switch(g){case Zn:return N;case er:return P;case tr:return S;case nr:return z;case rr:return $e}return s},"getTag"));function Lr(r,s){return s=s??d,!!s&&(typeof r=="number"||Pn.test(r))&&r>-1&&r%1==0&&r<s}o(Lr,"isIndex");function Ur(r){var s=typeof r;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?r!=="__proto__":r===null}o(Ur,"isKeyable");function Ir(r){return!!Dt&&Dt in r}o(Ir,"isMasked");function Dr(r){var s=r&&r.constructor,l=typeof s=="function"&&s.prototype||ze;return r===l}o(Dr,"isPrototype");function jr(r){return jt.call(r)}o(jr,"objectToString");function me(r){if(r!=null){try{return It.call(r)}catch{}try{return r+""}catch{}}return""}o(me,"toSource");function Kt(r,s){return r===s||r!==r&&s!==s}o(Kt,"eq");var Br=Vt(function(){return arguments}())?Vt:function(r){return Ue(r)&&Z.call(r,"callee")&&!qt.call(r,"callee")},Je=Array.isArray;function Gr(r){return r!=null&&Qt(r.length)&&!Yt(r)}o(Gr,"isArrayLike");var _t=Yn||Vr;function qr(r,s){return Wt(r,s)}o(qr,"isEqual");function Yt(r){if(!Zt(r))return!1;var s=Le(r);return s==v||s==_||s==p||s==$}o(Yt,"isFunction");function Qt(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=d}o(Qt,"isLength");function Zt(r){var s=typeof r;return r!=null&&(s=="object"||s=="function")}o(Zt,"isObject");function Ue(r){return r!=null&&typeof r=="object"}o(Ue,"isObjectLike");var en=Ut?Bn(Ut):Fr;function zr(r){return Gr(r)?Ar(r):Or(r)}o(zr,"keys");function Hr(){return[]}o(Hr,"stubArray");function Vr(){return!1}o(Vr,"stubFalse"),e.exports=qr});const{debug:b}=Ce,{headers:et,getPath:At,getQuery:os,normalizeUrl:on}=lt,De=o(e=>t=>(b("Actual url:",t),e(t)),"debuggableUrlFunc"),an={begin:e=>De(t=>t.indexOf(e)===0),end:e=>De(t=>t.substr(-e.length)===e),glob:e=>{const t=Vi(e);return De(n=>t.test(n))},express:e=>{const t=Oe(e);return De(n=>t.test(At(n)))},path:e=>De(t=>At(t)===e)},as=o(({headers:e})=>{if(b("Generating header matcher"),!e){b("  No header expectations defined - skipping");return}const t=et.toLowerCase(e);return b("  Expected headers:",t),(n,{headers:i={}})=>{b("Attempting to match headers");const a=et.toLowerCase(et.normalize(i));return b("  Expected headers:",t),b("  Actual headers:",a),Object.keys(t).every(c=>et.equal(a[c],t[c]))}},"getHeaderMatcher"),cs=o(({method:e})=>{if(b("Generating method matcher"),!e){b("  No method expectations defined - skipping");return}return b("  Expected method:",e),(t,{method:n})=>{b("Attempting to match method");const i=n?n.toLowerCase():"get";return b("  Expected method:",e),b("  Actual method:",i),e===i}},"getMethodMatcher"),ls=o(({query:e})=>{if(b("Generating query parameters matcher"),!e){b("  No query parameters expectations defined - skipping");return}const t=ve.parse(ve.stringify(e));b("  Expected query parameters:",e);const n=Object.keys(t);return i=>{b("Attempting to match query parameters");const a=ve.parse(os(i));return b("  Expected query parameters:",t),b("  Actual query parameters:",a),n.every(c=>Array.isArray(a[c])?Array.isArray(t[c])?xn(a[c].sort(),t[c].sort()):!1:a[c]===t[c])}},"getQueryStringMatcher"),us=o(({params:e,url:t})=>{if(b("Generating path parameters matcher"),!e){b("  No path parameters expectations defined - skipping");return}if(!/express:/.test(t))throw new Error("fetch-mock: matching on params is only possible when using an express: matcher");b("  Expected path parameters:",e);const n=Object.keys(e),i=[],a=Oe(t.replace(/^express:/,""),i);return c=>{b("Attempting to match path parameters");const d=a.exec(At(c))||[];d.shift();const h=i.reduce((u,{name:p},f)=>d[f]?Object.assign(u,{[p]:d[f]}):u,{});return b("  Expected path parameters:",e),b("  Actual path parameters:",h),n.every(u=>h[u]===e[u])}},"getParamsMatcher"),fs=o((e,t)=>{const n=t.getOption("matchPartialBody",e),{body:i}=e;return b("Generating body matcher"),(a,{body:c,method:d="get"})=>{if(b("Attempting to match body"),d.toLowerCase()==="get")return b("  GET request - skip matching body"),!0;let h;try{b("  Parsing request body as JSON"),h=JSON.parse(c)}catch(u){b("  Failed to parse request body as JSON",u)}return b("Expected body:",i),b("Actual body:",h),n&&b("matchPartialBody is true - checking for partial match only"),h&&(n?Nn(h,i):xn(h,i))}},"getBodyMatcher"),cn=o((e,t,n)=>{b("  Matching using full url",t);const i=on(t);return b("  Normalised url to:",t),e.identifier===t&&(b("  Updating route identifier to match normalized url:",t),e.identifier=i),a=>(b("Expected url:",i),b("Actual url:",a),n&&i.indexOf("?")?(b("Ignoring query string when matching url"),a.indexOf(i)===0):on(a)===i)},"getFullUrlMatcher"),ds=o(({functionMatcher:e})=>(b("Detected user defined function matcher",e),(...t)=>(b("Calling function matcher with arguments",t),e(...t))),"getFunctionMatcher"),hs=o(e=>{b("Generating url matcher");const{url:t,query:n}=e;if(t==="*")return b("  Using universal * rule to match any url"),()=>!0;if(t instanceof RegExp)return b("  Using regular expression to match url:",t),i=>t.test(i);if(t.href)return b("  Using URL object to match url",t),cn(e,t.href,n);for(const i in an)if(t.indexOf(i+":")===0){b(`  Using ${i}: pattern to match url`,t);const a=t.replace(new RegExp(`^${i}:`),"");return an[i](a)}return cn(e,t,n)},"getUrlMatcher");var ps=[{name:"query",matcher:ls},{name:"method",matcher:cs},{name:"headers",matcher:as},{name:"params",matcher:us},{name:"body",matcher:fs,usesBody:!0},{name:"functionMatcher",matcher:ds},{name:"url",matcher:hs}];const{debug:ln,setDebugNamespace:un,getDebug:tt}=Ce,fn=o(e=>e instanceof RegExp||typeof e=="string"||typeof e=="object"&&"href"in e,"isUrlMatcher"),gs=o(e=>typeof e=="function","isFunctionMatcher");class ue{constructor(t,n){this.fetchMock=n,tt("compileRoute()")("Compiling route"),this.init(t),this.sanitize(),this.validate(),this.generateMatcher(),this.limit(),this.delayResponse()}validate(){if(!("response"in this))throw new Error("fetch-mock: Each route must define a response");if(!ue.registeredMatchers.some(({name:t})=>t in this))throw new Error("fetch-mock: Each route must specify some criteria for matching calls to fetch. To match all calls use '*'")}init(t){const[n,i,a={}]=t,c={};fn(n)||gs(n)?c.matcher=n:Object.assign(c,n),typeof i<"u"&&(c.response=i),Object.assign(c,a),Object.assign(this,c)}sanitize(){const t=tt("sanitize()");t("Sanitizing route properties"),this.method&&(t(`Converting method ${this.method} to lower case`),this.method=this.method.toLowerCase()),fn(this.matcher)&&(t("Mock uses a url matcher",this.matcher),this.url=this.matcher,delete this.matcher),this.functionMatcher=this.matcher||this.functionMatcher,t("Setting route.identifier..."),t(`  route.name is ${this.name}`),t(`  route.url is ${this.url}`),t(`  route.functionMatcher is ${this.functionMatcher}`),this.identifier=this.name||this.url||this.functionMatcher,t(`  -> route.identifier set to ${this.identifier}`)}generateMatcher(){un("generateMatcher()"),ln("Compiling matcher for route");const t=ue.registeredMatchers.map(({name:n,matcher:i,usesBody:a})=>this[n]&&{matcher:i(this,this.fetchMock),usesBody:a}).filter(n=>!!n);this.usesBody=t.some(({usesBody:n})=>n),ln("Compiled matcher for route"),un(),this.matcher=(n,i={},a)=>t.every(({matcher:c})=>c(n,i,a))}limit(){const t=tt("limit()");if(t("Limiting number of requests to handle by route"),!this.repeat){t("  No `repeat` value set on route. Will match any number of requests");return}t(`  Route set to repeat ${this.repeat} times`);const n=this.matcher;let i=this.repeat;this.matcher=(a,c)=>{if(i&&n(a,c))return i--,!0},this.reset=()=>i=this.repeat}delayResponse(){const t=tt("delayResponse()");if(t("Applying response delay settings"),this.delay){t(`  Wrapping response in delay of ${this.delay} miliseconds`);const n=this.response;this.response=()=>(t(`Delaying response by ${this.delay} miliseconds`),new Promise(i=>setTimeout(()=>i(n),this.delay)))}else t("  No delay set on route. Will respond 'immediately' (but asynchronously)")}static addMatcher(t){ue.registeredMatchers.push(t)}}o(ue,"Route");ue.registeredMatchers=[];ps.forEach(ue.addMatcher);var Ft=ue;const{setDebugPhase:st,setDebugNamespace:ot,debug:C}=Ce,{normalizeUrl:Fn}=lt,ee={},ms=o(e=>typeof e=="string"&&/^[\da-zA-Z\-]+$/.test(e),"isName"),ys=o(function(e,t={},n){return{matcher:e}=new Ft([Object.assign({matcher:e,response:"ok"},t)],this),n.filter(({url:i,options:a})=>e(Fn(i),a))},"filterCallsWithMatcher"),fe=o(e=>function(...t){st("inspect");const n=e.call(this,...t);return st(),n},"formatDebug"),bs=o(e=>{if(!e)return;const{url:t,options:n,request:i,identifier:a,isUnmatched:c,response:d}=e,h=[t,n];return h.request=i,h.identifier=a,h.isUnmatched=c,h.response=d,h},"callObjToArray");ee.filterCalls=function(e,t){C("Filtering fetch calls");let n=this._calls,i="*";return[!0,"matched"].includes(e)?(C(`Filter provided is ${e}. Returning matched calls only`),n=n.filter(({isUnmatched:a})=>!a)):[!1,"unmatched"].includes(e)?(C(`Filter provided is ${e}. Returning unmatched calls only`),n=n.filter(({isUnmatched:a})=>a)):typeof e>"u"?(C("Filter provided is undefined. Returning all calls"),n=n):ms(e)?(C("Filter provided, looks like the name of a named route. Returning only calls handled by that route"),n=n.filter(({identifier:a})=>a===e)):(i=e==="*"?"*":Fn(e),this.routes.some(({identifier:a})=>a===i)&&(C(`Filter provided, ${e}, identifies a route. Returning only calls handled by that route`),n=n.filter(a=>a.identifier===i))),(t||i!=="*")&&n.length&&(typeof t=="string"&&(t={method:t}),C("Compiling filter and options to route in order to filter all calls",e),n=ys.call(this,i,t,n)),C(`Retrieved ${n.length} calls`),n.map(bs)};ee.calls=fe(function(e,t){return C("retrieving matching calls"),this.filterCalls(e,t)});ee.lastCall=fe(function(e,t){return C("retrieving last matching call"),[...this.filterCalls(e,t)].pop()});ee.lastUrl=fe(function(e,t){return C("retrieving url of last matching call"),(this.lastCall(e,t)||[])[0]});ee.lastOptions=fe(function(e,t){return C("retrieving options of last matching call"),(this.lastCall(e,t)||[])[1]});ee.lastResponse=fe(function(e,t){C("retrieving respose of last matching call"),console.warn(`When doing all the following:
- using node-fetch
- responding with a real network response (using spy() or fallbackToNetwork)
- using \`fetchMock.LastResponse()\`
- awaiting the body content
... the response will hang unless your source code also awaits the response body.
This is an unavoidable consequence of the nodejs implementation of streams.
`);const n=(this.lastCall(e,t)||[]).response;try{return n.clone()}catch{return Object.entries(n._fmResults).forEach(([a,c])=>{n[a]=()=>c}),n}});ee.called=fe(function(e,t){return C("checking if matching call was made"),!!this.filterCalls(e,t).length});ee.flush=fe(async function(e){ot("flush"),C(`flushing all fetch calls. ${e?"":"Not "}waiting for response bodies to complete download`);const t=this._holdingPromises;this._holdingPromises=[],C(`${t.length} fetch calls to be awaited`),await Promise.all(t),C("All fetch calls have completed"),e&&this._holdingPromises.length&&(C("Awaiting all fetch bodies to download"),await this.flush(e),C("All fetch bodies have completed downloading")),ot()});ee.done=fe(function(e){st("inspect"),ot("done"),C("Checking to see if expected calls have been made");let t;e&&typeof e!="boolean"?(C("Checking to see if expected calls have been made for single route:",e),t=[{identifier:e}]):(C("Checking to see if expected calls have been made for all routes"),t=this.routes);const n=t.map(({identifier:i})=>{if(!this.called(i))return C("No calls made for route:",i),console.warn(`Warning: ${i} not called`),!1;const a=(this.routes.find(d=>d.identifier===i)||{}).repeat;if(!a)return C("Route has been called at least once, and no expectation of more set:",i),!0;const c=this.filterCalls(i).length;return C(`Route called ${c} times:`,i),a>c?(C(`Route called ${c} times, but expected ${a}:`,i),console.warn(`Warning: ${i} only called ${c} times, but ${a} expected`),!1):!0}).every(i=>i);return ot(),st(),n});var ws=ee;const{debug:On}=Ce,I=Object.assign({},Hi,Ii,ws);I.addMatcher=function(e){Ft.addMatcher(e)};I.config={fallbackToNetwork:!1,includeContentLength:!0,sendAsJson:!0,warnOnFallback:!0,overwriteRoutes:void 0};I.createInstance=function(){On("Creating fetch-mock instance");const e=Object.create(I);return e._uncompiledRoutes=(this._uncompiledRoutes||[]).slice(),e.routes=e._uncompiledRoutes.map(t=>this.compileRoute(t)),e.fallbackResponse=this.fallbackResponse||void 0,e.config=Object.assign({},this.config||I.config),e._calls=[],e._holdingPromises=[],e.bindMethods(),e};I.compileRoute=function(e){return new Ft(e,this)};I.bindMethods=function(){this.fetchHandler=I.fetchHandler.bind(this),this.reset=this.restore=I.reset.bind(this),this.resetHistory=I.resetHistory.bind(this),this.resetBehavior=I.resetBehavior.bind(this)};I.sandbox=function(){On("Creating sandboxed fetch-mock instance");const t=Object.assign(o((n,i)=>t.fetchHandler(n,i),"fetchMockProxy"),I,this.createInstance(),{Headers:this.config.Headers,Request:this.config.Request,Response:this.config.Response});return t.bindMethods(),t.isSandbox=!0,t.default=t,t};I.getOption=function(e,t={}){return e in t?t[e]:this.config[e]};var Ge=I;const vs={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};var _s=vs;const Se=typeof window<"u"?window:self,{setUrlImplementation:Cs}=lt;Cs(Se.URL);Ge.global=Se;Ge.statusTextMap=_s;Ge.config=Object.assign(Ge.config,{Promise:Se.Promise,Request:Se.Request,Response:Se.Response,Headers:Se.Headers});var Ot=Ge.createInstance();const $n={count:3,previous:null,unread_count:2,next:"mockNotifications2",results:[{uuid:"31d69bd7-07e3-4567-a8f3-1aab41d86061",state:"SENT_STATE",payload:"There is a plain text notification",created_at:"08/06/2021 16:23",sent_at:"08/06/2021 16:24",read_at:null},{uuid:"f66ecf3b-637c-413a-91a7-e318c27ce02f",state:"SENT_STATE",payload:'There is an <i>html</i> notification! and there is a link here : <a href="https://github.com/uclouvain/osis-notification" target="_blank">osis-notification on Github</a>',created_at:"07/06/2021 12:22",sent_at:"07/06/2021 14:22",read_at:null},{uuid:"1445bb87-4965-44a5-9889-1b82f49166ec",state:"READ_STATE",payload:"This notification has already been read. And it have a super long text inside it, so you can see how the component will display something this long. Also, if you want to add more stories it is easy, please see the `NotificationViewer.stories.js` file.",created_at:"02/06/2021 12:22",sent_at:"02/06/2021 14:22",read_at:"02/06/2021 18:22"}]},Rs=o(()=>(Ot.restore().get("/?limit=15",{count:0,results:[]}),{components:{NotificationViewer:at},template:`
      <ul class="nav navbar-nav">
      <NotificationViewer baseUrl="/" />
      </ul>
    `}),"NoNotification"),As=o(()=>{const e=structuredClone($n);return Ot.restore().get("/?limit=2",function(){const t=structuredClone(e);return t.results=e.results.slice(0,2),t.unread_count=t.results.filter(n=>n.state!=="READ_STATE").length,t}).get("/?limit=4",function(){const t=structuredClone(e);return t.next=null,t.unread_count=t.results.filter(n=>n.state!=="READ_STATE").length,t}).put("/mark_all_as_read",function(){return e.results.forEach(t=>{t.state="READ_STATE",t.read_at=Date.now().toString()}),e.results}).patch("*",function(t){const n=e.results.find(i=>t.includes(i.uuid));return n.state=n.state==="READ_STATE"?"SENT_STATE":"READ_STATE",n.read_at=n.state==="READ_STATE"?Date.now().toString():null,n}),{components:{NotificationViewer:at},template:`
      <ul class="nav navbar-nav">
      <NotificationViewer baseUrl="/" :interval="10" :limit="2" />
      </ul>
    `}},"WithNotifications"),Ss=o(()=>(Ot.restore().get("/?limit=15",$n).put("/mark_all_as_read",500).patch("*",{throws:new Error("Network error")}),{components:{NotificationViewer:at},template:`
      <ul class="nav navbar-nav">
      <NotificationViewer baseUrl="/" :interval="10" />
      </ul>
    `}),"WithErrors"),Ns={parameters:{storySource:{source:`/*
 *
 * OSIS stands for Open Student Information System. It's an application
 * designed to manage the core business of higher education institutions,
 * such as universities, faculties, institutes and professional schools.
 * The core business involves the administration of students, teachers,
 * courses, programs and so on.
 *
 * Copyright (C) 2015-2023 Université catholique de Louvain (http://www.uclouvain.be)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * A copy of this license - GNU General Public License - is available
 * at the root of the source code of this program.  If not,
 * see http://www.gnu.org/licenses/.
 *
 */

import NotificationViewer from './NotificationViewer.vue';
import fetchMock from 'fetch-mock';
import type {Meta, StoryFn} from "@storybook/vue3";
import type {EntriesResponse, EntryRecord} from "./interfaces";

const mockNotifications : EntriesResponse = {
  count: 3,
  previous: null,
  unread_count: 2,
  next: 'mockNotifications2',
  results: [
    {
      uuid: '31d69bd7-07e3-4567-a8f3-1aab41d86061',
      state: 'SENT_STATE',
      payload: 'There is a plain text notification',
      created_at: '08/06/2021 16:23',
      sent_at: '08/06/2021 16:24',
      read_at: null,
    },
    {
      uuid: 'f66ecf3b-637c-413a-91a7-e318c27ce02f',
      state: 'SENT_STATE',
      payload: 'There is an <i>html</i> notification! and there is a link here : <a href="https://github.com/uclouvain/osis-notification" target="_blank">osis-notification on Github</a>',
      created_at: '07/06/2021 12:22',
      sent_at: '07/06/2021 14:22',
      read_at: null,
    },
    {
      uuid: '1445bb87-4965-44a5-9889-1b82f49166ec',
      state: 'READ_STATE',
      payload: 'This notification has already been read. And it have a super long text inside it, so you can see how the component will display something this long. Also, if you want to add more stories it is easy, please see the \`NotificationViewer.stories.js\` file.',
      created_at: '02/06/2021 12:22',
      sent_at: '02/06/2021 14:22',
      read_at: '02/06/2021 18:22',
    },
  ],
};

export const NoNotification: StoryFn<typeof NotificationViewer> = () => {
  fetchMock.restore().get('/?limit=15', {count: 0, results: []});
  return {
    components: {NotificationViewer},
    template: \`
      <ul class="nav navbar-nav">
      <NotificationViewer baseUrl="/" />
      </ul>
    \`,
  };
};

export const WithNotifications: StoryFn<typeof NotificationViewer> = () => {
  const notifications = structuredClone(mockNotifications);
  fetchMock.restore()
      .get('/?limit=2', function () {
        const page = structuredClone(notifications);
        page.results = notifications.results.slice(0, 2);
        page.unread_count = page.results.filter(n => n.state !== "READ_STATE").length;
        return page;
      })
      .get('/?limit=4', function () {
        const page = structuredClone(notifications);
        page.next = null;
        page.unread_count = page.results.filter(n => n.state !== "READ_STATE").length;
        return page;
      })
      .put('/mark_all_as_read', function () {
        notifications.results.forEach(notification => {
          notification.state = 'READ_STATE';
          notification.read_at = Date.now().toString();
        });
        return notifications.results;
      })
      .patch('*', function (url) {
        const notification = notifications.results.find(n => url.includes(n.uuid)) as EntryRecord;
        notification.state = (notification.state === "READ_STATE") ? "SENT_STATE" : "READ_STATE";
        notification.read_at = (notification.state === "READ_STATE") ? Date.now().toString() : null;
        return notification;
      });

  return {
    components: {NotificationViewer},
    template: \`
      <ul class="nav navbar-nav">
      <NotificationViewer baseUrl="/" :interval="10" :limit="2" />
      </ul>
    \`,
  };
};

export const WithErrors: StoryFn<typeof NotificationViewer> = () => {
  fetchMock.restore()
      .get('/?limit=15', mockNotifications)
      .put('/mark_all_as_read', 500)
      .patch('*', {throws: new Error('Network error')});

  return {
    components: {NotificationViewer},
    template: \`
      <ul class="nav navbar-nav">
      <NotificationViewer baseUrl="/" :interval="10" />
      </ul>
    \`,
  };
};

export default {
  title: 'Global component',
  component: NotificationViewer,
} as Meta<typeof NotificationViewer>;
`,locationsMap:{"no-notification":{startLoc:{col:66,line:65},endLoc:{col:1,line:75},startBody:{col:66,line:65},endBody:{col:1,line:75}},"with-notifications":{startLoc:{col:69,line:77},endLoc:{col:1,line:114},startBody:{col:69,line:77},endBody:{col:1,line:114}},"with-errors":{startLoc:{col:62,line:116},endLoc:{col:1,line:130},startBody:{col:62,line:116},endBody:{col:1,line:130}}}}},title:"Global component",component:at},xs=["NoNotification","WithNotifications","WithErrors"];export{Rs as NoNotification,Ss as WithErrors,As as WithNotifications,xs as __namedExportsOrder,Ns as default};
//# sourceMappingURL=NotificationViewer.stories-da8b10af.js.map
