var Xr=Object.defineProperty;var o=(e,t)=>Xr(e,"name",{value:t,configurable:!0});import{k as xt,l as J,m as Z,n as I,p as De,q as hn,t as be,u as Tt,f as Jr,v as pn,F as Ye,x as Kr,y as Yr}from"./vue.esm-bundler-f87cfd15.js";function Qr(e,t,n){var i={},a="",c="...",d=10>t?t:10,h=["img","br"],u=[],p=0,f=a,m='([\\w|-]+\\s*(=\\s*"[^"]*")?\\s*)*',y="\\s*\\/?\\s*",v="\\s*\\/\\s*",_=new RegExp("<\\/?\\w+\\s*"+m+v+">"),P=new RegExp("<\\/?\\w+\\s*"+m+y+">"),q=/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)|((mailto:)?[_.\w\-]+@([\w][\w\-]+\.)+[a-zA-Z]{2,3})/g,de=new RegExp("<img\\s*"+m+y+">"),N=new RegExp("\\W+","g"),S=!0,$,L,z,j;function Ce(x){var M=de.exec(x),F,B;return M?(F=M.index,B=M[0].length,x.substring(0,F)+x.substring(F+B)):x}o(Ce,"_removeImageTag");function ft(x){var M="";return x.reverse().forEach(function(F,B){h.indexOf(F)===-1&&(M+="</"+F+">")}),M}o(ft,"_dumpCloseTag");function Oe(x){var M=x.indexOf(" ");if(M===-1&&(M=x.indexOf(">"),M===-1))throw new Error("HTML tag is not well-formed : "+x);return x.substring(1,M)}o(Oe,"_getTag");function $e(x,M){var F=t-p,B=F,Ge=F<n.slop,Te=Ge?F:n.slop-1,Ee,dt=Ge?0:F-n.slop,ht=M||F+n.slop,ie;if(!n.truncateLastWord){if(Ee=x.slice(dt,ht),M&&Ee.length<=M)B=Ee.length;else for(;(ie=N.exec(Ee))!==null;)if(ie.index<Te){if(B=F-(Te-ie.index),ie.index===0&&F<=1)break}else if(ie.index===Te){B=F;break}else{B=F+(ie.index-Te);break}x.charAt(B-1).match(/\s$/)&&B--}return B}for(o($e,"_getEndPosition"),n=n||i,n.ellipsis=n.ellipsis!==void 0?n.ellipsis:c,n.truncateLastWord=n.truncateLastWord!==void 0?n.truncateLastWord:!0,n.slop=n.slop!==void 0?n.slop:d;S;){if(S=P.exec(e),!S){if(p>=t)break;if(S=q.exec(e),!S||S.index>=t){f+=e.substring(0,$e(e));break}for(;S;)$=S[0],L=S.index,f+=e.substring(0,L+$.length-p),e=e.substring(L+$.length),S=q.exec(e);break}if($=S[0],L=S.index,p+L>t){f+=e.substring(0,$e(e,L));break}else p+=L,f+=e.substring(0,L);$[1]==="/"?(u.pop(),j=null):(j=_.exec($),j||(z=Oe($),u.push(z))),j?f+=j[0]:f+=$,e=e.substring(L+$.length)}return e.length>t-p&&n.ellipsis&&(f+=n.ellipsis),f+=ft(u),n.keepImageTag||(f=Ce(f)),f}o(Qr,"truncate");var Zr=Qr;const gn=xt({name:"TruncateHtml",props:{htmlText:{type:String,default:""},length:{type:Number,default:100},lessButtonText:{type:String,default:"Show less"},contentCssClass:{type:String,default:""},containerCssClass:{type:String,default:""},buttonCssClass:{type:String,default:""},moreButtonText:{type:String,default:"Show more"}},data(){return{isTruncated:!0,truncatedHtml:Zr(this.htmlText,this.length)}}}),Nt=o((e,t)=>{const n=e.__vccOpts||e;for(const[i,a]of t)n[i]=a;return n},"_export_sfc"),ei=["innerHTML"];function ti(e,t,n,i,a,c){return J(),Z("div",{class:De(e.containerCssClass)},[I("div",{class:De([e.isTruncated?"truncated":"",e.contentCssClass]),innerHTML:e.isTruncated?e.truncatedHtml:e.htmlText},null,10,ei),e.truncatedHtml.length<e.htmlText.length?(J(),Z("button",{key:0,class:De(e.buttonCssClass),onClick:t[0]||(t[0]=hn(d=>e.isTruncated=!e.isTruncated,["prevent"]))},be(e.isTruncated?e.moreButtonText:e.lessButtonText),3)):Tt("",!0)],2)}o(ti,"_sfc_render$2");const ni=Nt(gn,[["render",ti]]);gn.__docgenInfo={displayName:"TruncateHtml",exportName:"default",description:"",tags:{},props:[{name:"htmlText",type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"length",type:{name:"number"},defaultValue:{func:!1,value:"100"}},{name:"lessButtonText",type:{name:"string"},defaultValue:{func:!1,value:'"Show less"'}},{name:"contentCssClass",type:{name:"string"},defaultValue:{func:!1,value:'""'}},{name:"containerCssClass",type:{name:"string"},defaultValue:{func:!1,value:'""'}},{name:"buttonCssClass",type:{name:"string"},defaultValue:{func:!1,value:'""'}},{name:"moreButtonText",type:{name:"string"},defaultValue:{func:!1,value:'"Show more"'}}]};const mn=xt({name:"NotificationEntry",components:{TruncateHtml:ni},props:{uuid:{type:String,required:!0},state:{type:String,required:!0},sentAt:{type:String,required:!0},payload:{type:String,required:!0},truncateLength:{type:Number,default:60}},emits:["toggle"],computed:{isSent:function(){return this.state==="SENT_STATE"}},mounted(){window.jQuery('[data-toggle="tooltip"]').tooltip({trigger:"hover",placement:"top",container:"body",template:'<div class="tooltip tooltip-notification" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},updated(){window.jQuery(`#notification-${this.uuid}`).tooltip("hide")},beforeUnmount(){window.jQuery(`#notification-${this.uuid}`).tooltip("destroy")}});const ri={class:"notification-dropdown-item"},ii=["id","checked","data-original-title"],si={class:"label label-primary"};function oi(e,t,n,i,a,c){const d=pn("TruncateHtml");return J(),Z("li",ri,[I("input",{id:`notification-${e.uuid}`,checked:e.isSent,type:"radio","data-toggle":"tooltip","data-original-title":e.isSent?e.$t("notification.mark_as_read"):e.$t("notification.mark_as_unread"),onClick:t[0]||(t[0]=hn(h=>e.$emit("toggle",e.uuid),["prevent"]))},null,8,ii),I("span",si,be(e.sentAt),1),Jr(d,{"button-css-class":"btn btn-link","container-css-class":"notification-text","content-css-class":e.isSent?"font-bold":"","html-text":e.payload,length:e.truncateLength,"less-button-text":e.$t("notification.show_less"),"more-button-text":e.$t("notification.show_more")},null,8,["content-css-class","html-text","length","less-button-text","more-button-text"])])}o(oi,"_sfc_render$1");const ai=Nt(mn,[["render",oi]]);mn.__docgenInfo={displayName:"NotificationEntry",exportName:"default",description:"",tags:{},props:[{name:"uuid",type:{name:"string"},required:!0},{name:"state",type:{name:"string"},required:!0},{name:"sentAt",type:{name:"string"},required:!0},{name:"payload",type:{name:"string"},required:!0},{name:"truncateLength",type:{name:"number"},defaultValue:{func:!1,value:"60"}}],events:[{name:"toggle"}]};function ci(e){if(document.cookie){const t=document.cookie.split(";");for(let n=0;n<t.length;n++){const i=t[n].trim();if(i.substring(0,e.length+1)===e+"=")return decodeURIComponent(i.substring(e.length+1))}}throw new Error(`No such cookie ${e}`)}o(ci,"getCookie");const yn=xt({name:"NotificationViewer",components:{NotificationEntry:ai},props:{baseUrl:{type:String,required:!0},interval:{type:Number,default:300},limit:{type:Number,default:15},truncateLength:{type:Number,default:60}},data(){return{notifications:[],hasNextPage:!1,animationEnabled:!1,pageSize:this.limit,error:"",loading:!0,unreadNotificationsCount:0,timer:0,csrfToken:ci("csrftoken")}},unmounted(){window.clearTimeout(this.timer)},mounted(){this.fetchNotifications(),jQuery(document).on("click.bs.dropdown.data-api",".notification-dropdown",e=>e.stopPropagation())},methods:{fetchNotifications:async function(){const e=await this.doRequest(`?limit=${this.pageSize}`,{},!0);e&&(e.unread_count&&(this.animationEnabled=!0),this.notifications=e.results,this.hasNextPage=!!e.next,this.unreadNotificationsCount=e.unread_count,this.timer=window.setTimeout(()=>void this.fetchNotifications(),this.interval*1e3))},toggleState:async function(e){const t=await this.doRequest(e,{method:"PATCH"});if(!t)return;const n=this.notifications.findIndex(i=>i.uuid===e);this.notifications[n]=t,t.state==="SENT_STATE"?this.unreadNotificationsCount++:this.unreadNotificationsCount--,this.notifications.filter(i=>i.state==="SENT_STATE").length!==this.unreadNotificationsCount&&await this.fetchNotifications()},markAllAsRead:async function(){const e=await this.doRequest("mark_all_as_read",{method:"PUT"});e&&e.length>0&&(this.notifications.forEach(t=>t.state="READ_STATE"),this.unreadNotificationsCount=0)},loadMore:async function(e){e.stopPropagation(),this.loading=!0,this.pageSize+=this.limit,await this.fetchNotifications()},doRequest:async function(e,t,n=!1){n&&(this.loading=!0);try{const i=await fetch(`${this.baseUrl}${e}`,{mode:"same-origin",headers:{"Content-Type":"application/json;charset=utf-8","X-CSRFToken":this.csrfToken},...t});if(i.status>=200&&i.status<300)return n&&(this.loading=!1),i.json();this.error=`${this.$t("notification_viewer.error")}  (${i.statusText})`}catch(i){this.error=`${this.$t("notification_viewer.error")} (${i.message})`}n&&(this.loading=!1)}}});const li=["data-count"],ui=I("span",{class:"fas fa-bell"},null,-1),fi=[ui],di={class:"dropdown-menu notification-dropdown"},hi={key:0,class:"progress"},pi={class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"100","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},gi={class:"sr-only"},mi=I("li",{role:"separator",class:"divider"},null,-1),yi={class:"alert alert-warning",role:"alert"},bi={key:2},wi=I("li",{role:"separator",class:"divider"},null,-1),vi={key:0,class:"text-center"};function _i(e,t,n,i,a,c){const d=pn("NotificationEntry");return J(),Z(Ye,null,[I("a",{class:"dropdown-toggle","data-toggle":"dropdown",role:"button","aria-haspopup":"true","aria-expanded":"false",onClick:t[0]||(t[0]=h=>e.animationEnabled=!1)},[I("div",{class:De(["bell",{"show-count":e.unreadNotificationsCount,notify:e.unreadNotificationsCount&&e.animationEnabled}]),"data-count":e.unreadNotificationsCount},fi,10,li)]),I("ul",di,[e.loading?(J(),Z("li",hi,[I("div",pi,[I("span",gi,be(e.$t("notification_viewer.loading")),1)])])):e.error?(J(),Z(Ye,{key:1},[mi,I("li",null,[I("div",yi,be(e.error),1)])],64)):Tt("",!0),e.notifications.length?(J(),Z(Ye,{key:3},[I("li",null,[I("a",{class:De(["btn",{disabled:!e.unreadNotificationsCount}]),onClick:t[1]||(t[1]=(...h)=>e.markAllAsRead&&e.markAllAsRead(...h))},be(e.$t("notification_viewer.mark_all_as_read")),3)]),wi,(J(!0),Z(Ye,null,Kr(e.notifications,h=>(J(),Yr(d,{key:h.uuid,uuid:h.uuid,state:h.state,"sent-at":h.sent_at,payload:h.payload,"truncate-length":e.truncateLength,onToggle:e.toggleState},null,8,["uuid","state","sent-at","payload","truncate-length","onToggle"]))),128)),e.hasNextPage?(J(),Z("li",vi,[I("button",{type:"button",class:"btn btn-link",onClick:t[2]||(t[2]=(...h)=>e.loadMore&&e.loadMore(...h))},be(e.$t("notification_viewer.load_more")),1)])):Tt("",!0)],64)):(J(),Z("li",bi,be(e.$t("notification_viewer.no_notifications")),1))])],64)}o(_i,"_sfc_render");const at=Nt(yn,[["render",_i]]);yn.__docgenInfo={displayName:"NotificationViewer",exportName:"default",description:"",tags:{},props:[{name:"baseUrl",type:{name:"string"},required:!0},{name:"interval",type:{name:"number"},defaultValue:{func:!1,value:"300"}},{name:"limit",type:{name:"number"},defaultValue:{func:!1,value:"15"}},{name:"truncateLength",type:{name:"number"},defaultValue:{func:!1,value:"60"}}]};var Qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ci(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}o(Ci,"unwrapExports");function ct(e,t){return t={exports:{}},e(t,t.exports),t.exports}o(ct,"createCommonjsModule");var Se=1e3,xe=Se*60,Ne=xe*60,ve=Ne*24,Ti=ve*7,Ei=ve*365.25,Ri=o(function(e,t){t=t||{};var n=typeof e;if(n==="string"&&e.length>0)return Ai(e);if(n==="number"&&isFinite(e))return t.long?xi(e):Si(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},"ms");function Ai(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return n*Ei;case"weeks":case"week":case"w":return n*Ti;case"days":case"day":case"d":return n*ve;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Ne;case"minutes":case"minute":case"mins":case"min":case"m":return n*xe;case"seconds":case"second":case"secs":case"sec":case"s":return n*Se;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}o(Ai,"parse");function Si(e){var t=Math.abs(e);return t>=ve?Math.round(e/ve)+"d":t>=Ne?Math.round(e/Ne)+"h":t>=xe?Math.round(e/xe)+"m":t>=Se?Math.round(e/Se)+"s":e+"ms"}o(Si,"fmtShort");function xi(e){var t=Math.abs(e);return t>=ve?Ze(e,t,ve,"day"):t>=Ne?Ze(e,t,Ne,"hour"):t>=xe?Ze(e,t,xe,"minute"):t>=Se?Ze(e,t,Se,"second"):e+" ms"}o(xi,"fmtLong");function Ze(e,t,n,i){var a=t>=n*1.5;return Math.round(e/n)+" "+i+(a?"s":"")}o(Ze,"plural");function Ni(e){n.debug=n,n.default=n,n.coerce=u,n.disable=c,n.enable=a,n.enabled=d,n.humanize=Ri,n.destroy=p,Object.keys(e).forEach(f=>{n[f]=e[f]}),n.names=[],n.skips=[],n.formatters={};function t(f){let m=0;for(let y=0;y<f.length;y++)m=(m<<5)-m+f.charCodeAt(y),m|=0;return n.colors[Math.abs(m)%n.colors.length]}o(t,"selectColor"),n.selectColor=t;function n(f){let m,y=null;function v(..._){if(!v.enabled)return;const P=v,q=Number(new Date),de=q-(m||q);P.diff=de,P.prev=m,P.curr=q,m=q,_[0]=n.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let N=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,($,L)=>{if($==="%%")return"%";N++;const z=n.formatters[L];if(typeof z=="function"){const j=_[N];$=z.call(P,j),_.splice(N,1),N--}return $}),n.formatArgs.call(P,_),(P.log||n.log).apply(P,_)}return o(v,"debug"),v.namespace=f,v.useColors=n.useColors(),v.color=n.selectColor(f),v.extend=i,v.destroy=n.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>y===null?n.enabled(f):y,set:_=>{y=_}}),typeof n.init=="function"&&n.init(v),v}o(n,"createDebug");function i(f,m){const y=n(this.namespace+(typeof m>"u"?":":m)+f);return y.log=this.log,y}o(i,"extend");function a(f){n.save(f),n.names=[],n.skips=[];let m;const y=(typeof f=="string"?f:"").split(/[\s,]+/),v=y.length;for(m=0;m<v;m++)y[m]&&(f=y[m].replace(/\*/g,".*?"),f[0]==="-"?n.skips.push(new RegExp("^"+f.substr(1)+"$")):n.names.push(new RegExp("^"+f+"$")))}o(a,"enable");function c(){const f=[...n.names.map(h),...n.skips.map(h).map(m=>"-"+m)].join(",");return n.enable(""),f}o(c,"disable");function d(f){if(f[f.length-1]==="*")return!0;let m,y;for(m=0,y=n.skips.length;m<y;m++)if(n.skips[m].test(f))return!1;for(m=0,y=n.names.length;m<y;m++)if(n.names[m].test(f))return!0;return!1}o(d,"enabled");function h(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}o(h,"toNamespace");function u(f){return f instanceof Error?f.stack||f.message:f}o(u,"coerce");function p(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return o(p,"destroy"),n.enable(n.load()),n}o(Ni,"setup");var Fi=Ni,K=ct(function(e,t){t.formatArgs=i,t.save=a,t.load=c,t.useColors=n,t.storage=d(),t.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}o(n,"useColors");function i(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;u.splice(1,0,p,"color: inherit");let f=0,m=0;u[0].replace(/%[a-zA-Z%]/g,y=>{y!=="%%"&&(f++,y==="%c"&&(m=f))}),u.splice(m,0,p)}o(i,"formatArgs"),t.log=console.debug||console.log||(()=>{});function a(u){try{u?t.storage.setItem("debug",u):t.storage.removeItem("debug")}catch{}}o(a,"save");function c(){let u;try{u=t.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u={}.DEBUG),u}o(c,"load");function d(){try{return localStorage}catch{}}o(d,"localstorage"),e.exports=Fi(t);const{formatters:h}=e.exports;h.j=function(u){try{return JSON.stringify(u)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}});K.formatArgs;K.save;K.load;K.useColors;K.storage;K.destroy;K.colors;K.log;let bn,nt="default",Et="";const Rt=o(()=>{bn=K(Et?`fetch-mock:${nt}:${Et}`:`fetch-mock:${nt}`)},"newDebug"),Oi=o(e=>K(`fetch-mock:${nt}:${e}`),"newDebugSandbox");Rt();var _e={debug:(...e)=>{bn(...e)},setDebugNamespace:e=>{Et=e,Rt()},setDebugPhase:e=>{nt=e||"default",Rt()},getDebug:e=>Oi(e)};const{debug:$i,setDebugPhase:wn}=_e,W={};W.mock=function(...e){return wn("setup"),e.length&&this.addRoute(e),this._mock()};W.addRoute=function(e){$i("Adding route",e);const t=this.compileRoute(e),n=this.routes.filter(({identifier:i,method:a})=>(typeof i=="function"?i===t.identifier:String(i)===String(t.identifier))&&(!a||!t.method||a===t.method));if(this.getOption("overwriteRoutes",t)===!1||!n.length)return this._uncompiledRoutes.push(e),this.routes.push(t);if(this.getOption("overwriteRoutes",t)===!0)return n.forEach(i=>{const a=this.routes.indexOf(i);this._uncompiledRoutes.splice(a,1,e),this.routes.splice(a,1,t)}),this.routes;if(n.length)throw new Error("fetch-mock: Adding route with same name or matcher as existing route. See `overwriteRoutes` option.");this._uncompiledRoutes.push(e),this.routes.push(t)};W._mock=function(){return this.isSandbox||(this.realFetch=this.realFetch||this.global.fetch,this.global.fetch=this.fetchHandler),wn(),this};W.catch=function(e){return this.fallbackResponse&&console.warn("calling fetchMock.catch() twice - are you sure you want to overwrite the previous fallback response"),this.fallbackResponse=e||"ok",this._mock()};W.spy=function(e){return this._mock(),e?this.mock(e,this.getNativeFetch()):this.catch(this.getNativeFetch())};const rt=o((e,t,n)=>{W[e]=function(i,a,c){return this[t](i,a,Object.assign(c||{},n))}},"defineShorthand"),it=o((e,t)=>{W[e]=function(n,i){return this[t]({},n,i)}},"defineGreedyShorthand");rt("sticky","mock",{sticky:!0});rt("once","mock",{repeat:1});it("any","mock");it("anyOnce","once");["get","post","put","delete","head","patch"].forEach(e=>{rt(e,"mock",{method:e}),rt(`${e}Once`,"once",{method:e}),it(`${e}Any`,e),it(`${e}AnyOnce`,`${e}Once`)});const Mi=o(e=>{typeof e=="function"&&(console.warn("Deprecated: Passing fetch-mock reset methods\ndirectly in as handlers for before/after test runner hooks.\nWrap in an arrow function instead e.g. `() => fetchMock.restore()`"),e())},"mochaAsyncHookWorkaround"),ki=o(({sticky:e})=>t=>e?[]:t.filter(({sticky:n})=>n),"getRouteRemover");W.resetBehavior=function(e={}){Mi(e);const t=ki(e);return this.routes=t(this.routes),this._uncompiledRoutes=t(this._uncompiledRoutes),this.realFetch&&!this.routes.length&&(this.global.fetch=this.realFetch,this.realFetch=void 0),this.fallbackResponse=void 0,this};W.resetHistory=function(){return this._calls=[],this._holdingPromises=[],this.routes.forEach(e=>e.reset&&e.reset()),this};W.restore=W.reset=function(e){return this.resetBehavior(e),this.resetHistory(),this};var Pi=W;const{getDebug:Li}=_e,rn=["body","headers","throws","status","redirectUrl"];class vn{constructor(t){this.debug=Li("ResponseBuilder()"),this.debug("Response builder created with options",t),Object.assign(this,t)}exec(){this.debug("building response"),this.normalizeResponseConfig(),this.constructFetchOpts(),this.constructResponseBody();const t=new this.fetchMock.config.Response(this.body,this.options),n=this.buildObservableResponse(t);return[t,n]}sendAsObject(){return rn.some(t=>this.responseConfig[t])?!Object.keys(this.responseConfig).every(t=>rn.includes(t)):!0}normalizeResponseConfig(){typeof this.responseConfig=="number"?(this.debug("building response using status",this.responseConfig),this.responseConfig={status:this.responseConfig}):(typeof this.responseConfig=="string"||this.sendAsObject())&&(this.debug("building text response from",this.responseConfig),this.responseConfig={body:this.responseConfig})}validateStatus(t){if(!t)return this.debug("No status provided. Defaulting to 200"),200;if(typeof t=="number"&&parseInt(t,10)!==t&&t>=200||t<600)return this.debug("Valid status provided",t),t;throw new TypeError(`fetch-mock: Invalid status ${t} passed on response object.
To respond with a JSON object that has status as a property assign the object to body
e.g. {"body": {"status: "registered"}}`)}constructFetchOpts(){this.options=this.responseConfig.options||{},this.options.url=this.responseConfig.redirectUrl||this.url,this.options.status=this.validateStatus(this.responseConfig.status),this.options.statusText=this.fetchMock.statusTextMap[String(this.options.status)],this.options.headers=new this.fetchMock.config.Headers(this.responseConfig.headers||{})}getOption(t){return this.fetchMock.getOption(t,this.route)}convertToJson(){this.getOption("sendAsJson")&&this.responseConfig.body!=null&&typeof this.body=="object"&&(this.debug("Stringifying JSON response body"),this.body=JSON.stringify(this.body),this.options.headers.has("Content-Type")||this.options.headers.set("Content-Type","application/json"))}setContentLength(){this.getOption("includeContentLength")&&typeof this.body=="string"&&!this.options.headers.has("Content-Length")&&(this.debug("Setting content-length header:",this.body.length.toString()),this.options.headers.set("Content-Length",this.body.length.toString()))}constructResponseBody(){if(this.body=this.responseConfig.body,this.convertToJson(),this.setContentLength(),this.Stream){this.debug("Creating response stream");const t=new this.Stream.Readable;this.body!=null&&t.push(this.body,"utf-8"),t.push(null),this.body=t}this.body=this.body}buildObservableResponse(t){const n=this.fetchMock;return t._fmResults={},this.debug("Wrapping Response in ES proxy for observability"),new Proxy(t,{get:(i,a)=>{if(this.responseConfig.redirectUrl){if(a==="url")return this.debug("Retrieving redirect url",this.responseConfig.redirectUrl),this.responseConfig.redirectUrl;if(a==="redirected")return this.debug("Retrieving redirected status",!0),!0}return typeof i[a]=="function"?(this.debug("Wrapping body promises in ES proxies for observability"),new Proxy(i[a],{apply:(c,d,h)=>{this.debug(`Calling res.${a}`);const u=c.apply(t,h);return u.then&&(n._holdingPromises.push(u.catch(()=>null)),i._fmResults[a]=u),u}})):i[a]}})}}o(vn,"ResponseBuilder");var Ui=o(e=>new vn(e).exec(),"responseBuilder");let le;const At=new RegExp("^[a-z]+://","i"),Ii=new RegExp("^//","i"),sn=o(e=>typeof e.raw=="function"?Object.entries(e.raw()):e[Symbol.iterator]?[...e]:Object.entries(e),"headersToArray"),on=o(e=>e.reduce((t,[n,i])=>Object.assign(t,{[n]:i}),{}),"zipObject"),Ct=o(e=>{if(typeof e=="function"||e instanceof RegExp||/^(begin|end|glob|express|path)\:/.test(e))return e;if(At.test(e))return new le(e).href;if(Ii.test(e))return new le(e,"http://dummy").href;{const t=new le(e,"http://dummy");return t.pathname+t.search}},"normalizeUrl"),Di=o(async e=>{try{return"body"in e?e.body.toString():e.clone().text()}catch{}},"extractBody");var lt={setUrlImplementation:e=>{le=e},normalizeRequest:(e,t,n)=>{if(n.prototype.isPrototypeOf(e)){const i={method:e.method},a=Di(e);typeof a<"u"&&(i.body=a);const c={url:Ct(e.url),options:Object.assign(i,t),request:e,signal:t&&t.signal||e.signal},d=sn(e.headers);return d.length&&(c.options.headers=on(d)),c}else{if(typeof e=="string"||typeof e=="object"&&"href"in e)return{url:Ct(e),options:t,signal:t&&t.signal};throw typeof e=="object"?new TypeError("fetch-mock: Unrecognised Request object. Read the Config and Installation sections of the docs"):new TypeError("fetch-mock: Invalid arguments passed to fetch")}},normalizeUrl:Ct,getPath:e=>(At.test(e)?new le(e):new le(e,"http://dummy")).pathname,getQuery:e=>{const t=At.test(e)?new le(e):new le(e,"http://dummy");return t.search?t.search.substr(1):""},headers:{normalize:e=>on(sn(e)),toLowerCase:e=>Object.keys(e).reduce((t,n)=>(t[n.toLowerCase()]=e[n],t),{}),equal:(e,t)=>(e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t],e.length!==t.length?!1:e.every((n,i)=>n===t[i]))}};const{debug:je,setDebugPhase:_n,getDebug:ut}=_e,Y={};class Cn extends Error{constructor(){super(...arguments),this.name="AbortError",this.message="The operation was aborted.",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}o(Cn,"AbortError");const ji=o(e=>typeof navigator>"u"||!navigator.vendor||navigator.vendor!=="Apple Computer, Inc."?e:async t=>{const{method:n}=t;if(!["POST","PUT","PATCH"].includes(n))return e(t);const i=await t.clone().text(),{cache:a,credentials:c,headers:d,integrity:h,mode:u,redirect:p,referrer:f}=t,m={body:i,cache:a,credentials:c,headers:d,integrity:h,mode:u,redirect:p,referrer:f,method:n};return e(t.url,m)},"patchNativeFetchForSafari"),Bi=o(async({response:e,responseIsFetch:t=!1},n,i,a)=>{const c=ut("resolve()");for(c("Recursively resolving function and promise responses");;)if(typeof e=="function"){if(c("  Response is a function"),t)return a?(c("  -> Calling fetch with Request instance"),e(a)):(c("  -> Calling fetch with url and options"),e(n,i));c("  -> Calling response function"),e=e(n,i,a)}else if(typeof e.then=="function")c("  Response is a promise"),c("  -> Resolving promise"),e=await e;else return c("  Response is not a function or a promise"),c("  -> Exiting response resolution recursion"),e},"resolve");Y.needsAsyncBodyExtraction=function({request:e}){return e&&this.routes.some(({usesBody:t})=>t)};Y.fetchHandler=function(e,t){_n("handle");const n=ut("fetchHandler()");n("fetch called with:",e,t);const i=lt.normalizeRequest(e,t,this.config.Request);return n("Request normalised"),n("  url",i.url),n("  options",i.options),n("  request",i.request),n("  signal",i.signal),this.needsAsyncBodyExtraction(i)?(n("Need to wait for Body to be streamed before calling router: switching to async mode"),this._extractBodyThenHandle(i)):this._fetchHandler(i)};Y._extractBodyThenHandle=async function(e){return e.options.body=await e.options.body,this._fetchHandler(e)};Y._fetchHandler=function({url:e,options:t,request:n,signal:i}){const{route:a,callLog:c}=this.executeRouter(e,t,n);this.recordCall(c);let d;return this._holdingPromises.push(new this.config.Promise(h=>d=h)),new this.config.Promise((h,u)=>{if(i){je("signal exists - enabling fetch abort");const p=o(()=>{je("aborting fetch"),u(typeof DOMException<"u"?new DOMException("The operation was aborted.","AbortError"):new Cn),d()},"abort");i.aborted&&(je("signal is already aborted - aborting the fetch"),p()),i.addEventListener("abort",p)}this.generateResponse({route:a,url:e,options:t,request:n,callLog:c}).then(h,u).then(d,d).then(()=>{_n()})})};Y.fetchHandler.isMock=!0;Y.executeRouter=function(e,t,n){const i=ut("executeRouter()"),a={url:e,options:t,request:n,isUnmatched:!0};if(i("Attempting to match request to a route"),this.getOption("fallbackToNetwork")==="always")return i("  Configured with fallbackToNetwork=always - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0}};const c=this.router(e,t,n);if(c)return i("  Matching route found"),{route:c,callLog:{url:e,options:t,request:n,identifier:c.identifier}};if(this.getOption("warnOnFallback")&&console.warn(`Unmatched ${t&&t.method||"GET"} to ${e}`),this.fallbackResponse)return i("  No matching route found - using fallbackResponse"),{route:{response:this.fallbackResponse},callLog:a};if(!this.getOption("fallbackToNetwork"))throw new Error(`fetch-mock: No fallback response defined for ${t&&t.method||"GET"} to ${e}`);return i("  Configured to fallbackToNetwork - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0},callLog:a}};Y.generateResponse=async function({route:e,url:t,options:n,request:i,callLog:a={}}){const c=ut("generateResponse()"),d=await Bi(e,t,n,i);if(d.throws&&typeof d!="function")throw c("response.throws is defined - throwing an error"),d.throws;if(this.config.Response.prototype.isPrototypeOf(d))return c("response is already a Response instance - returning it"),a.response=d,d;const[h,u]=Ui({url:t,responseConfig:d,fetchMock:this,route:e});return a.response=h,u};Y.router=function(e,t,n){const i=this.routes.find((a,c)=>(je(`Trying to match route ${c}`),a.matcher(e,t,n)));if(i)return i};Y.getNativeFetch=function(){const e=this.realFetch||this.isSandbox&&this.config.fetch;if(!e)throw new Error("fetch-mock: Falling back to network only available on global fetch-mock, or by setting config.fetch on sandboxed fetch-mock");return ji(e)};Y.recordCall=function(e){je("Recording fetch call",e),e&&this._calls.push(e)};var Gi=Y,qi=o(function(e,t){if(typeof e!="string")throw new TypeError("Expected a string");for(var n=String(e),i="",a=t?!!t.extended:!1,c=t?!!t.globstar:!1,d=!1,h=t&&typeof t.flags=="string"?t.flags:"",u,p=0,f=n.length;p<f;p++)switch(u=n[p],u){case"/":case"$":case"^":case"+":case".":case"(":case")":case"=":case"!":case"|":i+="\\"+u;break;case"?":if(a){i+=".";break}case"[":case"]":if(a){i+=u;break}case"{":if(a){d=!0,i+="(";break}case"}":if(a){d=!1,i+=")";break}case",":if(d){i+="|";break}i+="\\"+u;break;case"*":for(var m=n[p-1],y=1;n[p+1]==="*";)y++,p++;var v=n[p+1];if(!c)i+=".*";else{var _=y>1&&(m==="/"||m===void 0)&&(v==="/"||v===void 0);_?(i+="((?:[^/]*(?:/|$))*)",p++):i+="([^/]*)"}break;default:i+=u}return(!h||!~h.indexOf("g"))&&(i="^"+i+"$"),new RegExp(i,h)},"globToRegexp"),Fe=xn,zi=Ft,Hi=Ji,Vi=Rn,Wi=Sn,Tn="/",En="./",Xi=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function Ft(e,t){for(var n=[],i=0,a=0,c="",d=t&&t.delimiter||Tn,h=t&&t.delimiters||En,u=!1,p;(p=Xi.exec(e))!==null;){var f=p[0],m=p[1],y=p.index;if(c+=e.slice(a,y),a=y+f.length,m){c+=m[1],u=!0;continue}var v="",_=e[a],P=p[2],q=p[3],de=p[4],N=p[5];if(!u&&c.length){var S=c.length-1;h.indexOf(c[S])>-1&&(v=c[S],c=c.slice(0,S))}c&&(n.push(c),c="",u=!1);var $=v!==""&&_!==void 0&&_!==v,L=N==="+"||N==="*",z=N==="?"||N==="*",j=v||d,Ce=q||de;n.push({name:P||i++,prefix:v,delimiter:j,optional:z,repeat:L,partial:$,pattern:Ce?Ki(Ce):"[^"+ce(j)+"]+?"})}return(c||a<e.length)&&n.push(c+e.substr(a)),n}o(Ft,"parse$1");function Ji(e,t){return Rn(Ft(e,t))}o(Ji,"compile");function Rn(e){for(var t=new Array(e.length),n=0;n<e.length;n++)typeof e[n]=="object"&&(t[n]=new RegExp("^(?:"+e[n].pattern+")$"));return function(i,a){for(var c="",d=a&&a.encode||encodeURIComponent,h=0;h<e.length;h++){var u=e[h];if(typeof u=="string"){c+=u;continue}var p=i?i[u.name]:void 0,f;if(Array.isArray(p)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but got array');if(p.length===0){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var m=0;m<p.length;m++){if(f=d(p[m],u),!t[h].test(f))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'"');c+=(m===0?u.prefix:u.delimiter)+f}continue}if(typeof p=="string"||typeof p=="number"||typeof p=="boolean"){if(f=d(String(p),u),!t[h].test(f))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but got "'+f+'"');c+=u.prefix+f;continue}if(u.optional){u.partial&&(c+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be '+(u.repeat?"an array":"a string"))}return c}}o(Rn,"tokensToFunction");function ce(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}o(ce,"escapeString");function Ki(e){return e.replace(/([=!:$/()])/g,"\\$1")}o(Ki,"escapeGroup");function An(e){return e&&e.sensitive?"":"i"}o(An,"flags");function Yi(e,t){if(!t)return e;var n=e.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return e}o(Yi,"regexpToRegexp");function Qi(e,t,n){for(var i=[],a=0;a<e.length;a++)i.push(xn(e[a],t,n).source);return new RegExp("(?:"+i.join("|")+")",An(n))}o(Qi,"arrayToRegexp");function Zi(e,t,n){return Sn(Ft(e,n),t,n)}o(Zi,"stringToRegexp");function Sn(e,t,n){n=n||{};for(var i=n.strict,a=n.start!==!1,c=n.end!==!1,d=ce(n.delimiter||Tn),h=n.delimiters||En,u=[].concat(n.endsWith||[]).map(ce).concat("$").join("|"),p=a?"^":"",f=e.length===0,m=0;m<e.length;m++){var y=e[m];if(typeof y=="string")p+=ce(y),f=m===e.length-1&&h.indexOf(y[y.length-1])>-1;else{var v=y.repeat?"(?:"+y.pattern+")(?:"+ce(y.delimiter)+"(?:"+y.pattern+"))*":y.pattern;t&&t.push(y),y.optional?y.partial?p+=ce(y.prefix)+"("+v+")?":p+="(?:"+ce(y.prefix)+"("+v+"))?":p+=ce(y.prefix)+"("+v+")"}}return c?(i||(p+="(?:"+d+")?"),p+=u==="$"?"$":"(?="+u+")"):(i||(p+="(?:"+d+"(?="+u+"))?"),f||(p+="(?="+d+"|"+u+")")),new RegExp(p,An(n))}o(Sn,"tokensToRegExp");function xn(e,t,n){return e instanceof RegExp?Yi(e,t):Array.isArray(e)?Qi(e,t,n):Zi(e,t,n)}o(xn,"pathToRegexp");Fe.parse=zi;Fe.compile=Hi;Fe.tokensToFunction=Vi;Fe.tokensToRegExp=Wi;function es(e,t){return Object.prototype.hasOwnProperty.call(e,t)}o(es,"hasOwnProperty");var ts=o(function(e,t,n,i){t=t||"&",n=n||"=";var a={};if(typeof e!="string"||e.length===0)return a;var c=/\+/g;e=e.split(t);var d=1e3;i&&typeof i.maxKeys=="number"&&(d=i.maxKeys);var h=e.length;d>0&&h>d&&(h=d);for(var u=0;u<h;++u){var p=e[u].replace(c,"%20"),f=p.indexOf(n),m,y,v,_;f>=0?(m=p.substr(0,f),y=p.substr(f+1)):(m=p,y=""),v=decodeURIComponent(m),_=decodeURIComponent(y),es(a,v)?Array.isArray(a[v])?a[v].push(_):a[v]=[a[v],_]:a[v]=_}return a},"decode"),Ue=o(function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},"stringifyPrimitive"),ns=o(function(e,t,n,i){return t=t||"&",n=n||"=",e===null&&(e=void 0),typeof e=="object"?Object.keys(e).map(function(a){var c=encodeURIComponent(Ue(a))+n;return Array.isArray(e[a])?e[a].map(function(d){return c+encodeURIComponent(Ue(d))}).join(t):c+encodeURIComponent(Ue(e[a]))}).join(t):i?encodeURIComponent(Ue(i))+n+encodeURIComponent(Ue(e)):""},"encode"),we=ct(function(e,t){t.decode=t.parse=ts,t.encode=t.stringify=ns});we.decode;we.parse;we.encode;we.stringify;var Nn=ct(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(i){function a(c,d){return i.apply(this,arguments)}return o(a,"isSubset"),a.toString=function(){return i.toString()},a}(function(i,a){return typeof i!="object"||i===null||typeof a!="object"||a===null?!1:Object.keys(a).every(function(c){if(!i.propertyIsEnumerable(c))return!1;var d=a[c],h=i[c];return!(typeof d=="object"&&d!==null?!n(h,d):h!==d)})});t.default=n,e.exports=t.default});Ci(Nn);var Fn=ct(function(e,t){var n=200,i="__lodash_hash_undefined__",a=1,c=2,d=9007199254740991,h="[object Arguments]",u="[object Array]",p="[object AsyncFunction]",f="[object Boolean]",m="[object Date]",y="[object Error]",v="[object Function]",_="[object GeneratorFunction]",P="[object Map]",q="[object Number]",de="[object Null]",N="[object Object]",S="[object Promise]",$="[object Proxy]",L="[object RegExp]",z="[object Set]",j="[object String]",Ce="[object Symbol]",ft="[object Undefined]",Oe="[object WeakMap]",$e="[object ArrayBuffer]",x="[object DataView]",M="[object Float32Array]",F="[object Float64Array]",B="[object Int8Array]",Ge="[object Int16Array]",Te="[object Int32Array]",Ee="[object Uint8Array]",dt="[object Uint8ClampedArray]",ht="[object Uint16Array]",ie="[object Uint32Array]",kn=/[\\^$.*+?()[\]{}|]/g,Pn=/^\[object .+?Constructor\]$/,Ln=/^(?:0|[1-9]\d*)$/,T={};T[M]=T[F]=T[B]=T[Ge]=T[Te]=T[Ee]=T[dt]=T[ht]=T[ie]=!0,T[h]=T[u]=T[$e]=T[f]=T[x]=T[m]=T[y]=T[v]=T[P]=T[q]=T[N]=T[L]=T[z]=T[j]=T[Oe]=!1;var Mt=typeof Qe=="object"&&Qe&&Qe.Object===Object&&Qe,Un=typeof self=="object"&&self&&self.Object===Object&&self,te=Mt||Un||Function("return this")(),kt=t&&!t.nodeType&&t,Pt=kt&&!0&&e&&!e.nodeType&&e,Lt=Pt&&Pt.exports===kt,pt=Lt&&Mt.process,Ut=function(){try{return pt&&pt.binding&&pt.binding("util")}catch{}}(),It=Ut&&Ut.isTypedArray;function In(r,s){for(var l=-1,g=r==null?0:r.length,E=0,w=[];++l<g;){var A=r[l];s(A,l,r)&&(w[E++]=A)}return w}o(In,"arrayFilter");function Dn(r,s){for(var l=-1,g=s.length,E=r.length;++l<g;)r[E+l]=s[l];return r}o(Dn,"arrayPush");function jn(r,s){for(var l=-1,g=r==null?0:r.length;++l<g;)if(s(r[l],l,r))return!0;return!1}o(jn,"arraySome");function Bn(r,s){for(var l=-1,g=Array(r);++l<r;)g[l]=s(l);return g}o(Bn,"baseTimes");function Gn(r){return function(s){return r(s)}}o(Gn,"baseUnary");function qn(r,s){return r.has(s)}o(qn,"cacheHas");function zn(r,s){return r==null?void 0:r[s]}o(zn,"getValue");function Hn(r){var s=-1,l=Array(r.size);return r.forEach(function(g,E){l[++s]=[E,g]}),l}o(Hn,"mapToArray");function Vn(r,s){return function(l){return r(s(l))}}o(Vn,"overArg");function Wn(r){var s=-1,l=Array(r.size);return r.forEach(function(g){l[++s]=g}),l}o(Wn,"setToArray");var Xn=Array.prototype,Jn=Function.prototype,qe=Object.prototype,gt=te["__core-js_shared__"],Dt=Jn.toString,Q=qe.hasOwnProperty,jt=function(){var r=/[^.]+$/.exec(gt&&gt.keys&&gt.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),Bt=qe.toString,Kn=RegExp("^"+Dt.call(Q).replace(kn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gt=Lt?te.Buffer:void 0,ze=te.Symbol,qt=te.Uint8Array,zt=qe.propertyIsEnumerable,Yn=Xn.splice,he=ze?ze.toStringTag:void 0,Ht=Object.getOwnPropertySymbols,Qn=Gt?Gt.isBuffer:void 0,Zn=Vn(Object.keys,Object),mt=Re(te,"DataView"),Me=Re(te,"Map"),yt=Re(te,"Promise"),bt=Re(te,"Set"),wt=Re(te,"WeakMap"),ke=Re(Object,"create"),er=me(mt),tr=me(Me),nr=me(yt),rr=me(bt),ir=me(wt),Vt=ze?ze.prototype:void 0,vt=Vt?Vt.valueOf:void 0;function pe(r){var s=-1,l=r==null?0:r.length;for(this.clear();++s<l;){var g=r[s];this.set(g[0],g[1])}}o(pe,"Hash");function sr(){this.__data__=ke?ke(null):{},this.size=0}o(sr,"hashClear");function or(r){var s=this.has(r)&&delete this.__data__[r];return this.size-=s?1:0,s}o(or,"hashDelete");function ar(r){var s=this.__data__;if(ke){var l=s[r];return l===i?void 0:l}return Q.call(s,r)?s[r]:void 0}o(ar,"hashGet");function cr(r){var s=this.__data__;return ke?s[r]!==void 0:Q.call(s,r)}o(cr,"hashHas");function lr(r,s){var l=this.__data__;return this.size+=this.has(r)?0:1,l[r]=ke&&s===void 0?i:s,this}o(lr,"hashSet"),pe.prototype.clear=sr,pe.prototype.delete=or,pe.prototype.get=ar,pe.prototype.has=cr,pe.prototype.set=lr;function ne(r){var s=-1,l=r==null?0:r.length;for(this.clear();++s<l;){var g=r[s];this.set(g[0],g[1])}}o(ne,"ListCache");function ur(){this.__data__=[],this.size=0}o(ur,"listCacheClear");function fr(r){var s=this.__data__,l=Ve(s,r);if(l<0)return!1;var g=s.length-1;return l==g?s.pop():Yn.call(s,l,1),--this.size,!0}o(fr,"listCacheDelete");function dr(r){var s=this.__data__,l=Ve(s,r);return l<0?void 0:s[l][1]}o(dr,"listCacheGet");function hr(r){return Ve(this.__data__,r)>-1}o(hr,"listCacheHas");function pr(r,s){var l=this.__data__,g=Ve(l,r);return g<0?(++this.size,l.push([r,s])):l[g][1]=s,this}o(pr,"listCacheSet"),ne.prototype.clear=ur,ne.prototype.delete=fr,ne.prototype.get=dr,ne.prototype.has=hr,ne.prototype.set=pr;function ge(r){var s=-1,l=r==null?0:r.length;for(this.clear();++s<l;){var g=r[s];this.set(g[0],g[1])}}o(ge,"MapCache");function gr(){this.size=0,this.__data__={hash:new pe,map:new(Me||ne),string:new pe}}o(gr,"mapCacheClear");function mr(r){var s=We(this,r).delete(r);return this.size-=s?1:0,s}o(mr,"mapCacheDelete");function yr(r){return We(this,r).get(r)}o(yr,"mapCacheGet");function br(r){return We(this,r).has(r)}o(br,"mapCacheHas");function wr(r,s){var l=We(this,r),g=l.size;return l.set(r,s),this.size+=l.size==g?0:1,this}o(wr,"mapCacheSet"),ge.prototype.clear=gr,ge.prototype.delete=mr,ge.prototype.get=yr,ge.prototype.has=br,ge.prototype.set=wr;function He(r){var s=-1,l=r==null?0:r.length;for(this.__data__=new ge;++s<l;)this.add(r[s])}o(He,"SetCache");function vr(r){return this.__data__.set(r,i),this}o(vr,"setCacheAdd");function _r(r){return this.__data__.has(r)}o(_r,"setCacheHas"),He.prototype.add=He.prototype.push=vr,He.prototype.has=_r;function se(r){var s=this.__data__=new ne(r);this.size=s.size}o(se,"Stack");function Cr(){this.__data__=new ne,this.size=0}o(Cr,"stackClear");function Tr(r){var s=this.__data__,l=s.delete(r);return this.size=s.size,l}o(Tr,"stackDelete");function Er(r){return this.__data__.get(r)}o(Er,"stackGet");function Rr(r){return this.__data__.has(r)}o(Rr,"stackHas");function Ar(r,s){var l=this.__data__;if(l instanceof ne){var g=l.__data__;if(!Me||g.length<n-1)return g.push([r,s]),this.size=++l.size,this;l=this.__data__=new ge(g)}return l.set(r,s),this.size=l.size,this}o(Ar,"stackSet"),se.prototype.clear=Cr,se.prototype.delete=Tr,se.prototype.get=Er,se.prototype.has=Rr,se.prototype.set=Ar;function Sr(r,s){var l=Xe(r),g=!l&&Gr(r),E=!l&&!g&&_t(r),w=!l&&!g&&!E&&tn(r),A=l||g||E||w,O=A?Bn(r.length,String):[],k=O.length;for(var R in r)(s||Q.call(r,R))&&!(A&&(R=="length"||E&&(R=="offset"||R=="parent")||w&&(R=="buffer"||R=="byteLength"||R=="byteOffset")||Ur(R,k)))&&O.push(R);return O}o(Sr,"arrayLikeKeys");function Ve(r,s){for(var l=r.length;l--;)if(Yt(r[l][0],s))return l;return-1}o(Ve,"assocIndexOf");function xr(r,s,l){var g=s(r);return Xe(r)?g:Dn(g,l(r))}o(xr,"baseGetAllKeys");function Pe(r){return r==null?r===void 0?ft:de:he&&he in Object(r)?Pr(r):Br(r)}o(Pe,"baseGetTag");function Wt(r){return Le(r)&&Pe(r)==h}o(Wt,"baseIsArguments");function Xt(r,s,l,g,E){return r===s?!0:r==null||s==null||!Le(r)&&!Le(s)?r!==r&&s!==s:Nr(r,s,l,g,Xt,E)}o(Xt,"baseIsEqual");function Nr(r,s,l,g,E,w){var A=Xe(r),O=Xe(s),k=A?u:oe(r),R=O?u:oe(s);k=k==h?N:k,R=R==h?N:R;var G=k==N,X=R==N,U=k==R;if(U&&_t(r)){if(!_t(s))return!1;A=!0,G=!1}if(U&&!G)return w||(w=new se),A||tn(r)?Jt(r,s,l,g,E,w):Mr(r,s,k,l,g,E,w);if(!(l&a)){var H=G&&Q.call(r,"__wrapped__"),V=X&&Q.call(s,"__wrapped__");if(H||V){var ae=H?r.value():r,re=V?s.value():s;return w||(w=new se),E(ae,re,l,g,w)}}return U?(w||(w=new se),kr(r,s,l,g,E,w)):!1}o(Nr,"baseIsEqualDeep");function Fr(r){if(!en(r)||Dr(r))return!1;var s=Qt(r)?Kn:Pn;return s.test(me(r))}o(Fr,"baseIsNative");function Or(r){return Le(r)&&Zt(r.length)&&!!T[Pe(r)]}o(Or,"baseIsTypedArray");function $r(r){if(!jr(r))return Zn(r);var s=[];for(var l in Object(r))Q.call(r,l)&&l!="constructor"&&s.push(l);return s}o($r,"baseKeys");function Jt(r,s,l,g,E,w){var A=l&a,O=r.length,k=s.length;if(O!=k&&!(A&&k>O))return!1;var R=w.get(r);if(R&&w.get(s))return R==s;var G=-1,X=!0,U=l&c?new He:void 0;for(w.set(r,s),w.set(s,r);++G<O;){var H=r[G],V=s[G];if(g)var ae=A?g(V,H,G,s,r,w):g(H,V,G,r,s,w);if(ae!==void 0){if(ae)continue;X=!1;break}if(U){if(!jn(s,function(re,ye){if(!qn(U,ye)&&(H===re||E(H,re,l,g,w)))return U.push(ye)})){X=!1;break}}else if(!(H===V||E(H,V,l,g,w))){X=!1;break}}return w.delete(r),w.delete(s),X}o(Jt,"equalArrays");function Mr(r,s,l,g,E,w,A){switch(l){case x:if(r.byteLength!=s.byteLength||r.byteOffset!=s.byteOffset)return!1;r=r.buffer,s=s.buffer;case $e:return!(r.byteLength!=s.byteLength||!w(new qt(r),new qt(s)));case f:case m:case q:return Yt(+r,+s);case y:return r.name==s.name&&r.message==s.message;case L:case j:return r==s+"";case P:var O=Hn;case z:var k=g&a;if(O||(O=Wn),r.size!=s.size&&!k)return!1;var R=A.get(r);if(R)return R==s;g|=c,A.set(r,s);var G=Jt(O(r),O(s),g,E,w,A);return A.delete(r),G;case Ce:if(vt)return vt.call(r)==vt.call(s)}return!1}o(Mr,"equalByTag");function kr(r,s,l,g,E,w){var A=l&a,O=Kt(r),k=O.length,R=Kt(s),G=R.length;if(k!=G&&!A)return!1;for(var X=k;X--;){var U=O[X];if(!(A?U in s:Q.call(s,U)))return!1}var H=w.get(r);if(H&&w.get(s))return H==s;var V=!0;w.set(r,s),w.set(s,r);for(var ae=A;++X<k;){U=O[X];var re=r[U],ye=s[U];if(g)var nn=A?g(ye,re,U,s,r,w):g(re,ye,U,r,s,w);if(!(nn===void 0?re===ye||E(re,ye,l,g,w):nn)){V=!1;break}ae||(ae=U=="constructor")}if(V&&!ae){var Je=r.constructor,Ke=s.constructor;Je!=Ke&&"constructor"in r&&"constructor"in s&&!(typeof Je=="function"&&Je instanceof Je&&typeof Ke=="function"&&Ke instanceof Ke)&&(V=!1)}return w.delete(r),w.delete(s),V}o(kr,"equalObjects");function Kt(r){return xr(r,Hr,Lr)}o(Kt,"getAllKeys");function We(r,s){var l=r.__data__;return Ir(s)?l[typeof s=="string"?"string":"hash"]:l.map}o(We,"getMapData");function Re(r,s){var l=zn(r,s);return Fr(l)?l:void 0}o(Re,"getNative");function Pr(r){var s=Q.call(r,he),l=r[he];try{r[he]=void 0;var g=!0}catch{}var E=Bt.call(r);return g&&(s?r[he]=l:delete r[he]),E}o(Pr,"getRawTag");var Lr=Ht?function(r){return r==null?[]:(r=Object(r),In(Ht(r),function(s){return zt.call(r,s)}))}:Vr,oe=Pe;(mt&&oe(new mt(new ArrayBuffer(1)))!=x||Me&&oe(new Me)!=P||yt&&oe(yt.resolve())!=S||bt&&oe(new bt)!=z||wt&&oe(new wt)!=Oe)&&(oe=o(function(r){var s=Pe(r),l=s==N?r.constructor:void 0,g=l?me(l):"";if(g)switch(g){case er:return x;case tr:return P;case nr:return S;case rr:return z;case ir:return Oe}return s},"getTag"));function Ur(r,s){return s=s??d,!!s&&(typeof r=="number"||Ln.test(r))&&r>-1&&r%1==0&&r<s}o(Ur,"isIndex");function Ir(r){var s=typeof r;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?r!=="__proto__":r===null}o(Ir,"isKeyable");function Dr(r){return!!jt&&jt in r}o(Dr,"isMasked");function jr(r){var s=r&&r.constructor,l=typeof s=="function"&&s.prototype||qe;return r===l}o(jr,"isPrototype");function Br(r){return Bt.call(r)}o(Br,"objectToString");function me(r){if(r!=null){try{return Dt.call(r)}catch{}try{return r+""}catch{}}return""}o(me,"toSource");function Yt(r,s){return r===s||r!==r&&s!==s}o(Yt,"eq");var Gr=Wt(function(){return arguments}())?Wt:function(r){return Le(r)&&Q.call(r,"callee")&&!zt.call(r,"callee")},Xe=Array.isArray;function qr(r){return r!=null&&Zt(r.length)&&!Qt(r)}o(qr,"isArrayLike");var _t=Qn||Wr;function zr(r,s){return Xt(r,s)}o(zr,"isEqual");function Qt(r){if(!en(r))return!1;var s=Pe(r);return s==v||s==_||s==p||s==$}o(Qt,"isFunction");function Zt(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=d}o(Zt,"isLength");function en(r){var s=typeof r;return r!=null&&(s=="object"||s=="function")}o(en,"isObject");function Le(r){return r!=null&&typeof r=="object"}o(Le,"isObjectLike");var tn=It?Gn(It):Or;function Hr(r){return qr(r)?Sr(r):$r(r)}o(Hr,"keys");function Vr(){return[]}o(Vr,"stubArray");function Wr(){return!1}o(Wr,"stubFalse"),e.exports=zr});const{debug:b}=_e,{headers:et,getPath:St,getQuery:rs,normalizeUrl:an}=lt,Ie=o(e=>t=>(b("Actual url:",t),e(t)),"debuggableUrlFunc"),cn={begin:e=>Ie(t=>t.indexOf(e)===0),end:e=>Ie(t=>t.substr(-e.length)===e),glob:e=>{const t=qi(e);return Ie(n=>t.test(n))},express:e=>{const t=Fe(e);return Ie(n=>t.test(St(n)))},path:e=>Ie(t=>St(t)===e)},is=o(({headers:e})=>{if(b("Generating header matcher"),!e){b("  No header expectations defined - skipping");return}const t=et.toLowerCase(e);return b("  Expected headers:",t),(n,{headers:i={}})=>{b("Attempting to match headers");const a=et.toLowerCase(et.normalize(i));return b("  Expected headers:",t),b("  Actual headers:",a),Object.keys(t).every(c=>et.equal(a[c],t[c]))}},"getHeaderMatcher"),ss=o(({method:e})=>{if(b("Generating method matcher"),!e){b("  No method expectations defined - skipping");return}return b("  Expected method:",e),(t,{method:n})=>{b("Attempting to match method");const i=n?n.toLowerCase():"get";return b("  Expected method:",e),b("  Actual method:",i),e===i}},"getMethodMatcher"),os=o(({query:e})=>{if(b("Generating query parameters matcher"),!e){b("  No query parameters expectations defined - skipping");return}const t=we.parse(we.stringify(e));b("  Expected query parameters:",e);const n=Object.keys(t);return i=>{b("Attempting to match query parameters");const a=we.parse(rs(i));return b("  Expected query parameters:",t),b("  Actual query parameters:",a),n.every(c=>Array.isArray(a[c])?Array.isArray(t[c])?Fn(a[c].sort(),t[c].sort()):!1:a[c]===t[c])}},"getQueryStringMatcher"),as=o(({params:e,url:t})=>{if(b("Generating path parameters matcher"),!e){b("  No path parameters expectations defined - skipping");return}if(!/express:/.test(t))throw new Error("fetch-mock: matching on params is only possible when using an express: matcher");b("  Expected path parameters:",e);const n=Object.keys(e),i=[],a=Fe(t.replace(/^express:/,""),i);return c=>{b("Attempting to match path parameters");const d=a.exec(St(c))||[];d.shift();const h=i.reduce((u,{name:p},f)=>d[f]?Object.assign(u,{[p]:d[f]}):u,{});return b("  Expected path parameters:",e),b("  Actual path parameters:",h),n.every(u=>h[u]===e[u])}},"getParamsMatcher"),cs=o((e,t)=>{const n=t.getOption("matchPartialBody",e),{body:i}=e;return b("Generating body matcher"),(a,{body:c,method:d="get"})=>{if(b("Attempting to match body"),d.toLowerCase()==="get")return b("  GET request - skip matching body"),!0;let h;try{b("  Parsing request body as JSON"),h=JSON.parse(c)}catch(u){b("  Failed to parse request body as JSON",u)}return b("Expected body:",i),b("Actual body:",h),n&&b("matchPartialBody is true - checking for partial match only"),h&&(n?Nn(h,i):Fn(h,i))}},"getBodyMatcher"),ln=o((e,t,n)=>{b("  Matching using full url",t);const i=an(t);return b("  Normalised url to:",t),e.identifier===t&&(b("  Updating route identifier to match normalized url:",t),e.identifier=i),a=>(b("Expected url:",i),b("Actual url:",a),n&&i.indexOf("?")?(b("Ignoring query string when matching url"),a.indexOf(i)===0):an(a)===i)},"getFullUrlMatcher"),ls=o(({functionMatcher:e})=>(b("Detected user defined function matcher",e),(...t)=>(b("Calling function matcher with arguments",t),e(...t))),"getFunctionMatcher"),us=o(e=>{b("Generating url matcher");const{url:t,query:n}=e;if(t==="*")return b("  Using universal * rule to match any url"),()=>!0;if(t instanceof RegExp)return b("  Using regular expression to match url:",t),i=>t.test(i);if(t.href)return b("  Using URL object to match url",t),ln(e,t.href,n);for(const i in cn)if(t.indexOf(i+":")===0){b(`  Using ${i}: pattern to match url`,t);const a=t.replace(new RegExp(`^${i}:`),"");return cn[i](a)}return ln(e,t,n)},"getUrlMatcher");var fs=[{name:"query",matcher:os},{name:"method",matcher:ss},{name:"headers",matcher:is},{name:"params",matcher:as},{name:"body",matcher:cs,usesBody:!0},{name:"functionMatcher",matcher:ls},{name:"url",matcher:us}];const{debug:un,setDebugNamespace:fn,getDebug:tt}=_e,dn=o(e=>e instanceof RegExp||typeof e=="string"||typeof e=="object"&&"href"in e,"isUrlMatcher"),ds=o(e=>typeof e=="function","isFunctionMatcher");class ue{constructor(t,n){this.fetchMock=n,tt("compileRoute()")("Compiling route"),this.init(t),this.sanitize(),this.validate(),this.generateMatcher(),this.limit(),this.delayResponse()}validate(){if(!("response"in this))throw new Error("fetch-mock: Each route must define a response");if(!ue.registeredMatchers.some(({name:t})=>t in this))throw new Error("fetch-mock: Each route must specify some criteria for matching calls to fetch. To match all calls use '*'")}init(t){const[n,i,a={}]=t,c={};dn(n)||ds(n)?c.matcher=n:Object.assign(c,n),typeof i<"u"&&(c.response=i),Object.assign(c,a),Object.assign(this,c)}sanitize(){const t=tt("sanitize()");t("Sanitizing route properties"),this.method&&(t(`Converting method ${this.method} to lower case`),this.method=this.method.toLowerCase()),dn(this.matcher)&&(t("Mock uses a url matcher",this.matcher),this.url=this.matcher,delete this.matcher),this.functionMatcher=this.matcher||this.functionMatcher,t("Setting route.identifier..."),t(`  route.name is ${this.name}`),t(`  route.url is ${this.url}`),t(`  route.functionMatcher is ${this.functionMatcher}`),this.identifier=this.name||this.url||this.functionMatcher,t(`  -> route.identifier set to ${this.identifier}`)}generateMatcher(){fn("generateMatcher()"),un("Compiling matcher for route");const t=ue.registeredMatchers.map(({name:n,matcher:i,usesBody:a})=>this[n]&&{matcher:i(this,this.fetchMock),usesBody:a}).filter(n=>!!n);this.usesBody=t.some(({usesBody:n})=>n),un("Compiled matcher for route"),fn(),this.matcher=(n,i={},a)=>t.every(({matcher:c})=>c(n,i,a))}limit(){const t=tt("limit()");if(t("Limiting number of requests to handle by route"),!this.repeat){t("  No `repeat` value set on route. Will match any number of requests");return}t(`  Route set to repeat ${this.repeat} times`);const n=this.matcher;let i=this.repeat;this.matcher=(a,c)=>{if(i&&n(a,c))return i--,!0},this.reset=()=>i=this.repeat}delayResponse(){const t=tt("delayResponse()");if(t("Applying response delay settings"),this.delay){t(`  Wrapping response in delay of ${this.delay} miliseconds`);const n=this.response;this.response=()=>(t(`Delaying response by ${this.delay} miliseconds`),new Promise(i=>setTimeout(()=>i(n),this.delay)))}else t("  No delay set on route. Will respond 'immediately' (but asynchronously)")}static addMatcher(t){ue.registeredMatchers.push(t)}}o(ue,"Route");ue.registeredMatchers=[];fs.forEach(ue.addMatcher);var Ot=ue;const{setDebugPhase:st,setDebugNamespace:ot,debug:C}=_e,{normalizeUrl:On}=lt,ee={},hs=o(e=>typeof e=="string"&&/^[\da-zA-Z\-]+$/.test(e),"isName"),ps=o(function(e,t={},n){return{matcher:e}=new Ot([Object.assign({matcher:e,response:"ok"},t)],this),n.filter(({url:i,options:a})=>e(On(i),a))},"filterCallsWithMatcher"),fe=o(e=>function(...t){st("inspect");const n=e.call(this,...t);return st(),n},"formatDebug"),gs=o(e=>{if(!e)return;const{url:t,options:n,request:i,identifier:a,isUnmatched:c,response:d}=e,h=[t,n];return h.request=i,h.identifier=a,h.isUnmatched=c,h.response=d,h},"callObjToArray");ee.filterCalls=function(e,t){C("Filtering fetch calls");let n=this._calls,i="*";return[!0,"matched"].includes(e)?(C(`Filter provided is ${e}. Returning matched calls only`),n=n.filter(({isUnmatched:a})=>!a)):[!1,"unmatched"].includes(e)?(C(`Filter provided is ${e}. Returning unmatched calls only`),n=n.filter(({isUnmatched:a})=>a)):typeof e>"u"?(C("Filter provided is undefined. Returning all calls"),n=n):hs(e)?(C("Filter provided, looks like the name of a named route. Returning only calls handled by that route"),n=n.filter(({identifier:a})=>a===e)):(i=e==="*"?"*":On(e),this.routes.some(({identifier:a})=>a===i)&&(C(`Filter provided, ${e}, identifies a route. Returning only calls handled by that route`),n=n.filter(a=>a.identifier===i))),(t||i!=="*")&&n.length&&(typeof t=="string"&&(t={method:t}),C("Compiling filter and options to route in order to filter all calls",e),n=ps.call(this,i,t,n)),C(`Retrieved ${n.length} calls`),n.map(gs)};ee.calls=fe(function(e,t){return C("retrieving matching calls"),this.filterCalls(e,t)});ee.lastCall=fe(function(e,t){return C("retrieving last matching call"),[...this.filterCalls(e,t)].pop()});ee.lastUrl=fe(function(e,t){return C("retrieving url of last matching call"),(this.lastCall(e,t)||[])[0]});ee.lastOptions=fe(function(e,t){return C("retrieving options of last matching call"),(this.lastCall(e,t)||[])[1]});ee.lastResponse=fe(function(e,t){C("retrieving respose of last matching call"),console.warn(`When doing all the following:
- using node-fetch
- responding with a real network response (using spy() or fallbackToNetwork)
- using \`fetchMock.LastResponse()\`
- awaiting the body content
... the response will hang unless your source code also awaits the response body.
This is an unavoidable consequence of the nodejs implementation of streams.
`);const n=(this.lastCall(e,t)||[]).response;try{return n.clone()}catch{return Object.entries(n._fmResults).forEach(([a,c])=>{n[a]=()=>c}),n}});ee.called=fe(function(e,t){return C("checking if matching call was made"),!!this.filterCalls(e,t).length});ee.flush=fe(async function(e){ot("flush"),C(`flushing all fetch calls. ${e?"":"Not "}waiting for response bodies to complete download`);const t=this._holdingPromises;this._holdingPromises=[],C(`${t.length} fetch calls to be awaited`),await Promise.all(t),C("All fetch calls have completed"),e&&this._holdingPromises.length&&(C("Awaiting all fetch bodies to download"),await this.flush(e),C("All fetch bodies have completed downloading")),ot()});ee.done=fe(function(e){st("inspect"),ot("done"),C("Checking to see if expected calls have been made");let t;e&&typeof e!="boolean"?(C("Checking to see if expected calls have been made for single route:",e),t=[{identifier:e}]):(C("Checking to see if expected calls have been made for all routes"),t=this.routes);const n=t.map(({identifier:i})=>{if(!this.called(i))return C("No calls made for route:",i),console.warn(`Warning: ${i} not called`),!1;const a=(this.routes.find(d=>d.identifier===i)||{}).repeat;if(!a)return C("Route has been called at least once, and no expectation of more set:",i),!0;const c=this.filterCalls(i).length;return C(`Route called ${c} times:`,i),a>c?(C(`Route called ${c} times, but expected ${a}:`,i),console.warn(`Warning: ${i} only called ${c} times, but ${a} expected`),!1):!0}).every(i=>i);return ot(),st(),n});var ms=ee;const{debug:$n}=_e,D=Object.assign({},Gi,Pi,ms);D.addMatcher=function(e){Ot.addMatcher(e)};D.config={fallbackToNetwork:!1,includeContentLength:!0,sendAsJson:!0,warnOnFallback:!0,overwriteRoutes:void 0};D.createInstance=function(){$n("Creating fetch-mock instance");const e=Object.create(D);return e._uncompiledRoutes=(this._uncompiledRoutes||[]).slice(),e.routes=e._uncompiledRoutes.map(t=>this.compileRoute(t)),e.fallbackResponse=this.fallbackResponse||void 0,e.config=Object.assign({},this.config||D.config),e._calls=[],e._holdingPromises=[],e.bindMethods(),e};D.compileRoute=function(e){return new Ot(e,this)};D.bindMethods=function(){this.fetchHandler=D.fetchHandler.bind(this),this.reset=this.restore=D.reset.bind(this),this.resetHistory=D.resetHistory.bind(this),this.resetBehavior=D.resetBehavior.bind(this)};D.sandbox=function(){$n("Creating sandboxed fetch-mock instance");const t=Object.assign(o((n,i)=>t.fetchHandler(n,i),"fetchMockProxy"),D,this.createInstance(),{Headers:this.config.Headers,Request:this.config.Request,Response:this.config.Response});return t.bindMethods(),t.isSandbox=!0,t.default=t,t};D.getOption=function(e,t={}){return e in t?t[e]:this.config[e]};var Be=D;const ys={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};var bs=ys;const Ae=typeof window<"u"?window:self,{setUrlImplementation:ws}=lt;ws(Ae.URL);Be.global=Ae;Be.statusTextMap=bs;Be.config=Object.assign(Be.config,{Promise:Ae.Promise,Request:Ae.Request,Response:Ae.Response,Headers:Ae.Headers});var $t=Be.createInstance();const Mn={count:3,previous:null,unread_count:2,next:"mockNotifications2",results:[{uuid:"31d69bd7-07e3-4567-a8f3-1aab41d86061",state:"SENT_STATE",payload:"There is a plain text notification",created_at:"08/06/2021 16:23",sent_at:"08/06/2021 16:24",read_at:null},{uuid:"f66ecf3b-637c-413a-91a7-e318c27ce02f",state:"SENT_STATE",payload:'There is an <i>html</i> notification! and there is a link here : <a href="https://github.com/uclouvain/osis-notification" target="_blank">osis-notification on Github</a>',created_at:"07/06/2021 12:22",sent_at:"07/06/2021 14:22",read_at:null},{uuid:"1445bb87-4965-44a5-9889-1b82f49166ec",state:"READ_STATE",payload:"This notification has already been read. And it have a super long text inside it, so you can see how the component will display something this long. Also, if you want to add more stories it is easy, please see the `NotificationViewer.stories.js` file.",created_at:"02/06/2021 12:22",sent_at:"02/06/2021 14:22",read_at:"02/06/2021 18:22"}]},Cs=o(()=>($t.restore().get("/?limit=15",{count:0,results:[]}),{components:{NotificationViewer:at},template:`
      <ul class="nav navbar-nav">
        <li id="notification-viewer" class="dropdown">
          <NotificationViewer baseUrl="/" />
        </li>
      </ul>
    `}),"NoNotification"),Ts=o(()=>{const e=structuredClone(Mn);return $t.restore().get("/?limit=2",function(){const t=structuredClone(e);return t.results=e.results.slice(0,2),t.unread_count=t.results.filter(n=>n.state!=="READ_STATE").length,t}).get("/?limit=4",function(){const t=structuredClone(e);return t.next=null,t.unread_count=t.results.filter(n=>n.state!=="READ_STATE").length,t}).put("/mark_all_as_read",function(){return e.results.forEach(t=>{t.state="READ_STATE",t.read_at=Date.now().toString()}),e.results}).patch("*",function(t){const n=e.results.find(i=>t.includes(i.uuid));return n.state=n.state==="READ_STATE"?"SENT_STATE":"READ_STATE",n.read_at=n.state==="READ_STATE"?Date.now().toString():null,n}),{components:{NotificationViewer:at},template:`
      <ul class="nav navbar-nav">
        <li id="notification-viewer" class="dropdown">
          <NotificationViewer baseUrl="/" :interval="10" :limit="2" />
        </li>
      </ul>
    `}},"WithNotifications"),Es=o(()=>($t.restore().get("/?limit=15",Mn).put("/mark_all_as_read",500).patch("*",{throws:new Error("Network error")}),{components:{NotificationViewer:at},template:`
      <ul class="nav navbar-nav">
        <li id="notification-viewer" class="dropdown">
          <NotificationViewer baseUrl="/" :interval="10" />
        </li>
      </ul>
    `}),"WithErrors"),Rs={parameters:{storySource:{source:`/*
 *
 * OSIS stands for Open Student Information System. It's an application
 * designed to manage the core business of higher education institutions,
 * such as universities, faculties, institutes and professional schools.
 * The core business involves the administration of students, teachers,
 * courses, programs and so on.
 *
 * Copyright (C) 2015-2023 Universit catholique de Louvain (http://www.uclouvain.be)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * A copy of this license - GNU General Public License - is available
 * at the root of the source code of this program.  If not,
 * see http://www.gnu.org/licenses/.
 *
 */

import NotificationViewer from './NotificationViewer.vue';
import fetchMock from 'fetch-mock';
import type {Meta, StoryFn} from "@storybook/vue3";
import type {EntriesResponse, EntryRecord} from "./interfaces";

const mockNotifications : EntriesResponse = {
  count: 3,
  previous: null,
  unread_count: 2,
  next: 'mockNotifications2',
  results: [
    {
      uuid: '31d69bd7-07e3-4567-a8f3-1aab41d86061',
      state: 'SENT_STATE',
      payload: 'There is a plain text notification',
      created_at: '08/06/2021 16:23',
      sent_at: '08/06/2021 16:24',
      read_at: null,
    },
    {
      uuid: 'f66ecf3b-637c-413a-91a7-e318c27ce02f',
      state: 'SENT_STATE',
      payload: 'There is an <i>html</i> notification! and there is a link here : <a href="https://github.com/uclouvain/osis-notification" target="_blank">osis-notification on Github</a>',
      created_at: '07/06/2021 12:22',
      sent_at: '07/06/2021 14:22',
      read_at: null,
    },
    {
      uuid: '1445bb87-4965-44a5-9889-1b82f49166ec',
      state: 'READ_STATE',
      payload: 'This notification has already been read. And it have a super long text inside it, so you can see how the component will display something this long. Also, if you want to add more stories it is easy, please see the \`NotificationViewer.stories.js\` file.',
      created_at: '02/06/2021 12:22',
      sent_at: '02/06/2021 14:22',
      read_at: '02/06/2021 18:22',
    },
  ],
};

export const NoNotification: StoryFn<typeof NotificationViewer> = () => {
  fetchMock.restore().get('/?limit=15', {count: 0, results: []});
  return {
    components: {NotificationViewer},
    template: \`
      <ul class="nav navbar-nav">
        <li id="notification-viewer" class="dropdown">
          <NotificationViewer baseUrl="/" />
        </li>
      </ul>
    \`,
  };
};

export const WithNotifications: StoryFn<typeof NotificationViewer> = () => {
  const notifications = structuredClone(mockNotifications);
  fetchMock.restore()
      .get('/?limit=2', function () {
        const page = structuredClone(notifications);
        page.results = notifications.results.slice(0, 2);
        page.unread_count = page.results.filter(n => n.state !== "READ_STATE").length;
        return page;
      })
      .get('/?limit=4', function () {
        const page = structuredClone(notifications);
        page.next = null;
        page.unread_count = page.results.filter(n => n.state !== "READ_STATE").length;
        return page;
      })
      .put('/mark_all_as_read', function () {
        notifications.results.forEach(notification => {
          notification.state = 'READ_STATE';
          notification.read_at = Date.now().toString();
        });
        return notifications.results;
      })
      .patch('*', function (url) {
        const notification = notifications.results.find(n => url.includes(n.uuid)) as EntryRecord;
        notification.state = (notification.state === "READ_STATE") ? "SENT_STATE" : "READ_STATE";
        notification.read_at = (notification.state === "READ_STATE") ? Date.now().toString() : null;
        return notification;
      });

  return {
    components: {NotificationViewer},
    template: \`
      <ul class="nav navbar-nav">
        <li id="notification-viewer" class="dropdown">
          <NotificationViewer baseUrl="/" :interval="10" :limit="2" />
        </li>
      </ul>
    \`,
  };
};

export const WithErrors: StoryFn<typeof NotificationViewer> = () => {
  fetchMock.restore()
      .get('/?limit=15', mockNotifications)
      .put('/mark_all_as_read', 500)
      .patch('*', {throws: new Error('Network error')});

  return {
    components: {NotificationViewer},
    template: \`
      <ul class="nav navbar-nav">
        <li id="notification-viewer" class="dropdown">
          <NotificationViewer baseUrl="/" :interval="10" />
        </li>
      </ul>
    \`,
  };
};

export default {
  title: 'Global component',
  component: NotificationViewer,
} as Meta<typeof NotificationViewer>;
`,locationsMap:{"no-notification":{startLoc:{col:66,line:65},endLoc:{col:1,line:77},startBody:{col:66,line:65},endBody:{col:1,line:77}},"with-notifications":{startLoc:{col:69,line:79},endLoc:{col:1,line:118},startBody:{col:69,line:79},endBody:{col:1,line:118}},"with-errors":{startLoc:{col:62,line:120},endLoc:{col:1,line:136},startBody:{col:62,line:120},endBody:{col:1,line:136}}}}},title:"Global component",component:at},As=["NoNotification","WithNotifications","WithErrors"];export{Cs as NoNotification,Es as WithErrors,Ts as WithNotifications,As as __namedExportsOrder,Rs as default};
//# sourceMappingURL=NotificationViewer.stories-08db09a1.js.map
